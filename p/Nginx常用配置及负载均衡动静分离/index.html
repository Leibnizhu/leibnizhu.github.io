<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æœ€è¿‘æ€»ç»“äº†ä¸€äº›æŠ€æœ¯æ–‡æ¡£ï¼ŒåŸæœ¬ç”¨äºç»„å†…åˆ†äº«çš„ï¼Œå‘åˆ°åšå®¢é‡Œå¤‡å¿˜ã€‚
Nginxæ¦‚è¿° ç®€ä»‹ Nginxæ˜¯ä¸€ä¸ªè‡ªç”±ã€å¼€æºã€é«˜æ€§èƒ½åŠè½»é‡çº§çš„HTTPæœåŠ¡å™¨åŠåè½¬ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç¨³å®šã€åŠŸèƒ½ä¸°å¯Œã€é…ç½®ç®€å•åŠå ç”¨ç³»ç»Ÿèµ„æºå°‘è€Œè‘—ç§°ã€‚
Nginx è¶…è¶Š Apache çš„é«˜æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œä½¿å¾—å›½å†…ä½¿ç”¨ Nginx ä½œä¸º Web æœåŠ¡å™¨çš„ç½‘ç«™ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚
åŸºç¡€åŠŸèƒ½  å¤„ç†é™æ€æ–‡ä»¶ï¼Œç´¢å¼•æ–‡ä»¶ä»¥åŠè‡ªåŠ¨ç´¢å¼•ï¼› åå‘ä»£ç†åŠ é€Ÿ(æ— ç¼“å­˜)ï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› FastCGIï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› æ¨¡å—åŒ–çš„ç»“æ„ã€‚è¿‡æ»¤å™¨åŒ…æ‹¬gzipping, byte ranges, chunked responses, ä»¥åŠ SSI-filter ã€‚åœ¨SSIè¿‡æ»¤å™¨ä¸­ï¼Œåˆ°åŒä¸€ä¸ªproxyæˆ–FastCGIçš„å¤šä¸ªå­è¯·æ±‚å¹¶å‘å¤„ç†ï¼› SSL å’Œ TLS SNI æ”¯æŒã€‚  ä¼˜åŠ¿ Nginxä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘ï¼Œæ€§èƒ½æ˜¯å…¶æœ€é‡è¦çš„è€ƒé‡, å®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ ã€‚å®ƒæ”¯æŒå†…æ ¸Pollæ¨¡å‹ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ, æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾50,000ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚
Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨: Nginx æ—¢å¯ä»¥åœ¨å†…éƒ¨ç›´æ¥æ”¯æŒ Rails å’Œ PHP ç¨‹åºå¯¹å¤–è¿›è¡ŒæœåŠ¡, ä¹Ÿå¯ä»¥æ”¯æŒä½œä¸º HTTPä»£ç†æœåŠ¡å™¨å¯¹å¤–è¿›è¡ŒæœåŠ¡ã€‚
Nginxå…·æœ‰å¾ˆé«˜çš„ç¨³å®šæ€§ã€‚å…¶å®ƒHTTPæœåŠ¡å™¨ï¼Œå½“é‡åˆ°è®¿é—®çš„å³°å€¼ï¼Œæˆ–è€…æœ‰äººæ¶æ„å‘èµ·æ…¢é€Ÿè¿æ¥æ—¶ï¼Œä¹Ÿå¾ˆå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ç‰©ç†å†…å­˜è€—å°½é¢‘ç¹äº¤æ¢ï¼Œå¤±å»å“åº”ï¼Œåªèƒ½é‡å¯æœåŠ¡å™¨ã€‚ä¾‹å¦‚å½“å‰apacheä¸€æ—¦ä¸Šåˆ°200ä¸ªä»¥ä¸Šè¿›ç¨‹ï¼Œwebå“åº”é€Ÿåº¦å°±æ˜æ˜¾éå¸¸ç¼“æ…¢äº†ã€‚è€ŒNginxé‡‡å–äº†åˆ†é˜¶æ®µèµ„æºåˆ†é…æŠ€æœ¯ï¼Œä½¿å¾—å®ƒçš„CPUä¸å†…å­˜å ç”¨ç‡éå¸¸ä½ã€‚
nginxå®˜æ–¹è¡¨ç¤ºä¿æŒ10,000ä¸ªæ²¡æœ‰æ´»åŠ¨çš„è¿æ¥ï¼Œå®ƒåªå 2.5Må†…å­˜ï¼Œå°±ç¨³å®šæ€§è€Œè¨€, nginxæ¯”lighthttpdæ›´èƒœä¸€ç­¹ã€‚
Nginxæ”¯æŒçƒ­éƒ¨ç½²ã€‚å®ƒçš„å¯åŠ¨ç‰¹åˆ«å®¹æ˜“, å¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ°7*24ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œæ•°ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚ä½ è¿˜èƒ½å¤Ÿåœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯¹è½¯ä»¶ç‰ˆæœ¬è¿›è¡Œè¿›è¡Œå‡çº§ã€‚
Nginxé‡‡ç”¨Cè¿›è¡Œç¼–å†™, ä¸è®ºæ˜¯ç³»ç»Ÿèµ„æºå¼€é”€è¿˜æ˜¯CPUä½¿ç”¨æ•ˆç‡éƒ½æ¯” Perlbal è¦å¥½å¾ˆå¤šã€‚
Nginxå®‰è£… ä¸‹è½½ åˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆï¼š nginx: download
ç¯å¢ƒå‡†å¤‡ å‡†å¤‡gccç­‰ç¼–è¯‘ç¯å¢ƒï¼š
sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev make build-essential gcc ç¼–è¯‘å®‰è£… å°†ä¸‹è½½åˆ°çš„."><title>Nginxå¸¸ç”¨é…ç½®åŠè´Ÿè½½å‡è¡¡ã€åŠ¨é™åˆ†ç¦»</title><link rel=canonical href=https://leibnizhu.github.io/p/Nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/><link rel=stylesheet href=/scss/style.min.f6e1f9fc3ff66a58601c08d5ce96493eafb5f1b936be2f7b2eacd3e7784f2f38.css><meta property="og:title" content="Nginxå¸¸ç”¨é…ç½®åŠè´Ÿè½½å‡è¡¡ã€åŠ¨é™åˆ†ç¦»"><meta property="og:description" content="æœ€è¿‘æ€»ç»“äº†ä¸€äº›æŠ€æœ¯æ–‡æ¡£ï¼ŒåŸæœ¬ç”¨äºç»„å†…åˆ†äº«çš„ï¼Œå‘åˆ°åšå®¢é‡Œå¤‡å¿˜ã€‚
Nginxæ¦‚è¿° ç®€ä»‹ Nginxæ˜¯ä¸€ä¸ªè‡ªç”±ã€å¼€æºã€é«˜æ€§èƒ½åŠè½»é‡çº§çš„HTTPæœåŠ¡å™¨åŠåè½¬ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç¨³å®šã€åŠŸèƒ½ä¸°å¯Œã€é…ç½®ç®€å•åŠå ç”¨ç³»ç»Ÿèµ„æºå°‘è€Œè‘—ç§°ã€‚
Nginx è¶…è¶Š Apache çš„é«˜æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œä½¿å¾—å›½å†…ä½¿ç”¨ Nginx ä½œä¸º Web æœåŠ¡å™¨çš„ç½‘ç«™ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚
åŸºç¡€åŠŸèƒ½  å¤„ç†é™æ€æ–‡ä»¶ï¼Œç´¢å¼•æ–‡ä»¶ä»¥åŠè‡ªåŠ¨ç´¢å¼•ï¼› åå‘ä»£ç†åŠ é€Ÿ(æ— ç¼“å­˜)ï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› FastCGIï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› æ¨¡å—åŒ–çš„ç»“æ„ã€‚è¿‡æ»¤å™¨åŒ…æ‹¬gzipping, byte ranges, chunked responses, ä»¥åŠ SSI-filter ã€‚åœ¨SSIè¿‡æ»¤å™¨ä¸­ï¼Œåˆ°åŒä¸€ä¸ªproxyæˆ–FastCGIçš„å¤šä¸ªå­è¯·æ±‚å¹¶å‘å¤„ç†ï¼› SSL å’Œ TLS SNI æ”¯æŒã€‚  ä¼˜åŠ¿ Nginxä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘ï¼Œæ€§èƒ½æ˜¯å…¶æœ€é‡è¦çš„è€ƒé‡, å®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ ã€‚å®ƒæ”¯æŒå†…æ ¸Pollæ¨¡å‹ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ, æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾50,000ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚
Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨: Nginx æ—¢å¯ä»¥åœ¨å†…éƒ¨ç›´æ¥æ”¯æŒ Rails å’Œ PHP ç¨‹åºå¯¹å¤–è¿›è¡ŒæœåŠ¡, ä¹Ÿå¯ä»¥æ”¯æŒä½œä¸º HTTPä»£ç†æœåŠ¡å™¨å¯¹å¤–è¿›è¡ŒæœåŠ¡ã€‚
Nginxå…·æœ‰å¾ˆé«˜çš„ç¨³å®šæ€§ã€‚å…¶å®ƒHTTPæœåŠ¡å™¨ï¼Œå½“é‡åˆ°è®¿é—®çš„å³°å€¼ï¼Œæˆ–è€…æœ‰äººæ¶æ„å‘èµ·æ…¢é€Ÿè¿æ¥æ—¶ï¼Œä¹Ÿå¾ˆå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ç‰©ç†å†…å­˜è€—å°½é¢‘ç¹äº¤æ¢ï¼Œå¤±å»å“åº”ï¼Œåªèƒ½é‡å¯æœåŠ¡å™¨ã€‚ä¾‹å¦‚å½“å‰apacheä¸€æ—¦ä¸Šåˆ°200ä¸ªä»¥ä¸Šè¿›ç¨‹ï¼Œwebå“åº”é€Ÿåº¦å°±æ˜æ˜¾éå¸¸ç¼“æ…¢äº†ã€‚è€ŒNginxé‡‡å–äº†åˆ†é˜¶æ®µèµ„æºåˆ†é…æŠ€æœ¯ï¼Œä½¿å¾—å®ƒçš„CPUä¸å†…å­˜å ç”¨ç‡éå¸¸ä½ã€‚
nginxå®˜æ–¹è¡¨ç¤ºä¿æŒ10,000ä¸ªæ²¡æœ‰æ´»åŠ¨çš„è¿æ¥ï¼Œå®ƒåªå 2.5Må†…å­˜ï¼Œå°±ç¨³å®šæ€§è€Œè¨€, nginxæ¯”lighthttpdæ›´èƒœä¸€ç­¹ã€‚
Nginxæ”¯æŒçƒ­éƒ¨ç½²ã€‚å®ƒçš„å¯åŠ¨ç‰¹åˆ«å®¹æ˜“, å¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ°7*24ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œæ•°ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚ä½ è¿˜èƒ½å¤Ÿåœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯¹è½¯ä»¶ç‰ˆæœ¬è¿›è¡Œè¿›è¡Œå‡çº§ã€‚
Nginxé‡‡ç”¨Cè¿›è¡Œç¼–å†™, ä¸è®ºæ˜¯ç³»ç»Ÿèµ„æºå¼€é”€è¿˜æ˜¯CPUä½¿ç”¨æ•ˆç‡éƒ½æ¯” Perlbal è¦å¥½å¾ˆå¤šã€‚
Nginxå®‰è£… ä¸‹è½½ åˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆï¼š nginx: download
ç¯å¢ƒå‡†å¤‡ å‡†å¤‡gccç­‰ç¼–è¯‘ç¯å¢ƒï¼š
sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev make build-essential gcc ç¼–è¯‘å®‰è£… å°†ä¸‹è½½åˆ°çš„."><meta property="og:url" content="https://leibnizhu.github.io/p/Nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/"><meta property="og:site_name" content="Heaven's Door"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="å¹¶å‘"><meta property="article:tag" content="è´Ÿè½½å‡è¡¡"><meta property="article:tag" content="åŠ¨é™åˆ†ç¦»"><meta property="article:published_time" content="2016-11-26T12:17:21+00:00"><meta property="article:modified_time" content="2016-11-26T12:17:21+00:00"><meta property="og:image" content="https://leibnizhu.github.io/"><meta name=twitter:title content="Nginxå¸¸ç”¨é…ç½®åŠè´Ÿè½½å‡è¡¡ã€åŠ¨é™åˆ†ç¦»"><meta name=twitter:description content="æœ€è¿‘æ€»ç»“äº†ä¸€äº›æŠ€æœ¯æ–‡æ¡£ï¼ŒåŸæœ¬ç”¨äºç»„å†…åˆ†äº«çš„ï¼Œå‘åˆ°åšå®¢é‡Œå¤‡å¿˜ã€‚
Nginxæ¦‚è¿° ç®€ä»‹ Nginxæ˜¯ä¸€ä¸ªè‡ªç”±ã€å¼€æºã€é«˜æ€§èƒ½åŠè½»é‡çº§çš„HTTPæœåŠ¡å™¨åŠåè½¬ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç¨³å®šã€åŠŸèƒ½ä¸°å¯Œã€é…ç½®ç®€å•åŠå ç”¨ç³»ç»Ÿèµ„æºå°‘è€Œè‘—ç§°ã€‚
Nginx è¶…è¶Š Apache çš„é«˜æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œä½¿å¾—å›½å†…ä½¿ç”¨ Nginx ä½œä¸º Web æœåŠ¡å™¨çš„ç½‘ç«™ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚
åŸºç¡€åŠŸèƒ½  å¤„ç†é™æ€æ–‡ä»¶ï¼Œç´¢å¼•æ–‡ä»¶ä»¥åŠè‡ªåŠ¨ç´¢å¼•ï¼› åå‘ä»£ç†åŠ é€Ÿ(æ— ç¼“å­˜)ï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› FastCGIï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› æ¨¡å—åŒ–çš„ç»“æ„ã€‚è¿‡æ»¤å™¨åŒ…æ‹¬gzipping, byte ranges, chunked responses, ä»¥åŠ SSI-filter ã€‚åœ¨SSIè¿‡æ»¤å™¨ä¸­ï¼Œåˆ°åŒä¸€ä¸ªproxyæˆ–FastCGIçš„å¤šä¸ªå­è¯·æ±‚å¹¶å‘å¤„ç†ï¼› SSL å’Œ TLS SNI æ”¯æŒã€‚  ä¼˜åŠ¿ Nginxä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘ï¼Œæ€§èƒ½æ˜¯å…¶æœ€é‡è¦çš„è€ƒé‡, å®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ ã€‚å®ƒæ”¯æŒå†…æ ¸Pollæ¨¡å‹ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ, æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾50,000ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚
Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨: Nginx æ—¢å¯ä»¥åœ¨å†…éƒ¨ç›´æ¥æ”¯æŒ Rails å’Œ PHP ç¨‹åºå¯¹å¤–è¿›è¡ŒæœåŠ¡, ä¹Ÿå¯ä»¥æ”¯æŒä½œä¸º HTTPä»£ç†æœåŠ¡å™¨å¯¹å¤–è¿›è¡ŒæœåŠ¡ã€‚
Nginxå…·æœ‰å¾ˆé«˜çš„ç¨³å®šæ€§ã€‚å…¶å®ƒHTTPæœåŠ¡å™¨ï¼Œå½“é‡åˆ°è®¿é—®çš„å³°å€¼ï¼Œæˆ–è€…æœ‰äººæ¶æ„å‘èµ·æ…¢é€Ÿè¿æ¥æ—¶ï¼Œä¹Ÿå¾ˆå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ç‰©ç†å†…å­˜è€—å°½é¢‘ç¹äº¤æ¢ï¼Œå¤±å»å“åº”ï¼Œåªèƒ½é‡å¯æœåŠ¡å™¨ã€‚ä¾‹å¦‚å½“å‰apacheä¸€æ—¦ä¸Šåˆ°200ä¸ªä»¥ä¸Šè¿›ç¨‹ï¼Œwebå“åº”é€Ÿåº¦å°±æ˜æ˜¾éå¸¸ç¼“æ…¢äº†ã€‚è€ŒNginxé‡‡å–äº†åˆ†é˜¶æ®µèµ„æºåˆ†é…æŠ€æœ¯ï¼Œä½¿å¾—å®ƒçš„CPUä¸å†…å­˜å ç”¨ç‡éå¸¸ä½ã€‚
nginxå®˜æ–¹è¡¨ç¤ºä¿æŒ10,000ä¸ªæ²¡æœ‰æ´»åŠ¨çš„è¿æ¥ï¼Œå®ƒåªå 2.5Må†…å­˜ï¼Œå°±ç¨³å®šæ€§è€Œè¨€, nginxæ¯”lighthttpdæ›´èƒœä¸€ç­¹ã€‚
Nginxæ”¯æŒçƒ­éƒ¨ç½²ã€‚å®ƒçš„å¯åŠ¨ç‰¹åˆ«å®¹æ˜“, å¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ°7*24ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œæ•°ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚ä½ è¿˜èƒ½å¤Ÿåœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯¹è½¯ä»¶ç‰ˆæœ¬è¿›è¡Œè¿›è¡Œå‡çº§ã€‚
Nginxé‡‡ç”¨Cè¿›è¡Œç¼–å†™, ä¸è®ºæ˜¯ç³»ç»Ÿèµ„æºå¼€é”€è¿˜æ˜¯CPUä½¿ç”¨æ•ˆç‡éƒ½æ¯” Perlbal è¦å¥½å¾ˆå¤šã€‚
Nginxå®‰è£… ä¸‹è½½ åˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆï¼š nginx: download
ç¯å¢ƒå‡†å¤‡ å‡†å¤‡gccç­‰ç¼–è¯‘ç¯å¢ƒï¼š
sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev make build-essential gcc ç¼–è¯‘å®‰è£… å°†ä¸‹è½½åˆ°çš„."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leibnizhu.github.io/"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu4af873b90feb2f44d14cf5fcf42d034c_7593_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸŸ</span></figure><div class=site-meta><h1 class=site-name><a href=/>Heaven's Door</a></h1><h2 class=site-description>That cold black cloud is comin' down, Feels like I'm knockin' on heaven's doorâ€¦</h2></div></header><ol class=social-menu><li><a href=mailto:leibnizhu@gmail.com target=_blank title=Email><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-gmail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=https://github.com/leibnizhu target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://leibnizhu.github.io target=_blank title=Home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg></a></li><li><a href=https://leibnizhu.github.io/running target=_blank title=Running><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-run" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="13" cy="4" r="1"/><path d="M4 17l5 1 .75-1.5"/><path d="M15 21v-4l-4-3 1-6"/><path d="M7 12V9l5-1 3 3 3 1"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/About/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/Links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/Nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/>Nginxå¸¸ç”¨é…ç½®åŠè´Ÿè½½å‡è¡¡ã€åŠ¨é™åˆ†ç¦»</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Nov 26, 2016</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>2 minute read</time></div></footer></div></header><section class=article-content><p>æœ€è¿‘æ€»ç»“äº†ä¸€äº›æŠ€æœ¯æ–‡æ¡£ï¼ŒåŸæœ¬ç”¨äºç»„å†…åˆ†äº«çš„ï¼Œå‘åˆ°åšå®¢é‡Œå¤‡å¿˜ã€‚</p><h1 id=nginxæ¦‚è¿°>Nginxæ¦‚è¿°</h1><h2 id=ç®€ä»‹>ç®€ä»‹</h2><p>Nginxæ˜¯ä¸€ä¸ªè‡ªç”±ã€å¼€æºã€é«˜æ€§èƒ½åŠè½»é‡çº§çš„HTTPæœåŠ¡å™¨åŠåè½¬ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç¨³å®šã€åŠŸèƒ½ä¸°å¯Œã€é…ç½®ç®€å•åŠå ç”¨ç³»ç»Ÿèµ„æºå°‘è€Œè‘—ç§°ã€‚<br>Nginx è¶…è¶Š Apache çš„é«˜æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œä½¿å¾—å›½å†…ä½¿ç”¨ Nginx ä½œä¸º Web æœåŠ¡å™¨çš„ç½‘ç«™ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚</p><h2 id=åŸºç¡€åŠŸèƒ½>åŸºç¡€åŠŸèƒ½</h2><ul><li>å¤„ç†é™æ€æ–‡ä»¶ï¼Œç´¢å¼•æ–‡ä»¶ä»¥åŠè‡ªåŠ¨ç´¢å¼•ï¼›</li><li>åå‘ä»£ç†åŠ é€Ÿ(æ— ç¼“å­˜)ï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼›</li><li>FastCGIï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼›</li><li>æ¨¡å—åŒ–çš„ç»“æ„ã€‚è¿‡æ»¤å™¨åŒ…æ‹¬gzipping, byte ranges, chunked responses, ä»¥åŠ SSI-filter ã€‚åœ¨SSIè¿‡æ»¤å™¨ä¸­ï¼Œåˆ°åŒä¸€ä¸ªproxyæˆ–FastCGIçš„å¤šä¸ªå­è¯·æ±‚å¹¶å‘å¤„ç†ï¼›</li><li>SSL å’Œ TLS SNI æ”¯æŒã€‚</li></ul><h2 id=ä¼˜åŠ¿>ä¼˜åŠ¿</h2><p>Nginx<strong>ä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘</strong>ï¼Œæ€§èƒ½æ˜¯å…¶æœ€é‡è¦çš„è€ƒé‡, å®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ ã€‚å®ƒæ”¯æŒå†…æ ¸Pollæ¨¡å‹ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ, æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾50,000ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚<br>Nginxä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨: Nginx æ—¢å¯ä»¥åœ¨<strong>å†…éƒ¨ç›´æ¥æ”¯æŒ Rails å’Œ PHP ç¨‹åº</strong>å¯¹å¤–è¿›è¡ŒæœåŠ¡, ä¹Ÿå¯ä»¥<strong>æ”¯æŒä½œä¸º HTTPä»£ç†æœåŠ¡å™¨</strong>å¯¹å¤–è¿›è¡ŒæœåŠ¡ã€‚<br>Nginx<strong>å…·æœ‰å¾ˆé«˜çš„ç¨³å®šæ€§</strong>ã€‚å…¶å®ƒHTTPæœåŠ¡å™¨ï¼Œå½“é‡åˆ°è®¿é—®çš„å³°å€¼ï¼Œæˆ–è€…æœ‰äººæ¶æ„å‘èµ·æ…¢é€Ÿè¿æ¥æ—¶ï¼Œä¹Ÿå¾ˆå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ç‰©ç†å†…å­˜è€—å°½é¢‘ç¹äº¤æ¢ï¼Œå¤±å»å“åº”ï¼Œåªèƒ½é‡å¯æœåŠ¡å™¨ã€‚ä¾‹å¦‚å½“å‰apacheä¸€æ—¦ä¸Šåˆ°200ä¸ªä»¥ä¸Šè¿›ç¨‹ï¼Œwebå“åº”é€Ÿåº¦å°±æ˜æ˜¾éå¸¸ç¼“æ…¢äº†ã€‚è€ŒNginxé‡‡å–äº†åˆ†é˜¶æ®µèµ„æºåˆ†é…æŠ€æœ¯ï¼Œä½¿å¾—å®ƒçš„CPUä¸å†…å­˜å ç”¨ç‡éå¸¸ä½ã€‚<br>nginxå®˜æ–¹è¡¨ç¤ºä¿æŒ10,000ä¸ªæ²¡æœ‰æ´»åŠ¨çš„è¿æ¥ï¼Œå®ƒåªå 2.5Må†…å­˜ï¼Œå°±ç¨³å®šæ€§è€Œè¨€, nginxæ¯”lighthttpdæ›´èƒœä¸€ç­¹ã€‚<br>Nginx<strong>æ”¯æŒçƒ­éƒ¨ç½²</strong>ã€‚å®ƒçš„å¯åŠ¨ç‰¹åˆ«å®¹æ˜“, å¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ°7*24ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œæ•°ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚ä½ è¿˜èƒ½å¤Ÿåœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯¹è½¯ä»¶ç‰ˆæœ¬è¿›è¡Œè¿›è¡Œå‡çº§ã€‚<br>Nginxé‡‡ç”¨Cè¿›è¡Œç¼–å†™, ä¸è®ºæ˜¯<strong>ç³»ç»Ÿèµ„æºå¼€é”€è¿˜æ˜¯CPUä½¿ç”¨æ•ˆç‡</strong>éƒ½æ¯” Perlbal è¦å¥½å¾ˆå¤šã€‚</p><h1 id=nginxå®‰è£…>Nginxå®‰è£…</h1><h2 id=ä¸‹è½½>ä¸‹è½½</h2><p>åˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆï¼š
<a class=link href=http://nginx.org/en/download.html target=_blank rel=noopener>nginx: download</a></p><h2 id=ç¯å¢ƒå‡†å¤‡>ç¯å¢ƒå‡†å¤‡</h2><p>å‡†å¤‡gccç­‰ç¼–è¯‘ç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install libpcre3 libpcre3-dev openssl libssl-dev make build-essential gcc
</span></span></code></pre></div><h2 id=ç¼–è¯‘å®‰è£…>ç¼–è¯‘å®‰è£…</h2><p>å°†ä¸‹è½½åˆ°çš„.tar.gzåŒ…è§£å‹ï¼Œè¿›å…¥è§£å‹åçš„ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div><p>å³å¯å®‰è£…åˆ°/usr/local/nginxä¸­ã€‚<br>å¦‚æœéœ€è¦SSLï¼Œå¯å®‰è£…OpenSSLï¼Œæœ‰äº›Linuxå‘è¡Œç‰ˆè‡ªå¸¦OpenSSLæ— éœ€é¢å¤–å®‰è£…ï¼Œéœ€è¦å®‰è£…çš„åˆ°OpenSSLå®˜ç½‘ä¸‹è½½.tar.gzåŒ…è§£å‹ç¼–è¯‘å³å¯ã€‚</p><h2 id=å¯åŠ¨å…³é—­>å¯åŠ¨&å…³é—­</h2><h3 id=å¯åŠ¨>å¯åŠ¨</h3><p>æ‰§è¡Œ</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo /usr/local/nginx/sbin/nginx
</span></span></code></pre></div><p>å¯åŠ¨Nginxã€‚<br>ä¸€èˆ¬make installåä¼šå®‰è£…åˆ°PATHä¸­ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œsudo nginxã€‚
æ‰§è¡Œnginx -væ˜¾ç¤ºNginxç‰ˆæœ¬ã€‚</p><h3 id=é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</h3><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -s reload
</span></span></code></pre></div><h3 id=å…³é—­>å…³é—­</h3><p>Nginxæ²¡æœ‰æä¾›å…³é—­çš„æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡psæ‰¾åˆ°è¿›ç¨‹IDåï¼Œç”¨killå‘½ä»¤å…³é—­ã€‚<br>å¦‚ å¼ºåˆ¶é€€å‡º sudo kill-9 [PID]ï¼Œæˆ–å‘é€å…¶ä»–é€€å‡ºçš„æŒ‡ä»¤å¦‚TERMã€‚<br>æ³¨ï¼šnginxåŒ…å«workerå’Œmasterä¸¤ä¸ªè¿›ç¨‹ï¼Œå¼ºåˆ¶å…³é—­æ—¶ä¸¤è€…å‡éœ€å…³é—­ï¼š
<img src=/p/Nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/process.png width=569 height=61 srcset="/p/Nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/process_hufd9fac45deb26eff39a4bb948c61313c_6290_480x0_resize_box_3.png 480w, /p/Nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/process_hufd9fac45deb26eff39a4bb948c61313c_6290_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=932 data-flex-basis=2238px></p><h1 id=nginxé…ç½®>Nginxé…ç½®</h1><p>ä¸‹é¢ä»¥DSPä¸šåŠ¡å¹³å°çš„Nginxé…ç½®ä¸ºä¾‹è¿›è¡Œè®²è§£ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#776e71>#user  nobody;</span>
</span></span><span style=display:flex><span>worker_processes  1;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>#æ ¹æ®CPUæ ¸æ•°è®¾å®šworkerå·¥ä½œçš„CPUæ ¸å¿ƒmask</span>
</span></span><span style=display:flex><span><span style=color:#776e71>#worker_cpu_affinity 1000;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>#error_log  logs/error.log;</span>
</span></span><span style=display:flex><span><span style=color:#776e71>#error_log  logs/error.log  notice;</span>
</span></span><span style=display:flex><span><span style=color:#776e71>#error_log  logs/error.log  info;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>#pid  logs/nginx.pid;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>events <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span> worker_connections  1024;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>http <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span> include mime.types;
</span></span><span style=display:flex><span> default_type  application/octet-stream;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> log_format mylog <span style=color:#48b685>&#39;$remote_addr$time_local$request$http_referer$status$body_bytes_sent$request_time&#39;</span>;
</span></span><span style=display:flex><span> access_log logs/access.log mylog <span style=color:#ef6155>buffer</span><span style=color:#5bc4bf>=</span>32k <span style=color:#ef6155>flush</span><span style=color:#5bc4bf>=</span>5s;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> sendfile  on;
</span></span><span style=display:flex><span> <span style=color:#776e71>#tcp_nopush  on;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#776e71>#keepalive_timeout  0;</span>
</span></span><span style=display:flex><span> keepalive_timeout  1000;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#776e71>#gzip  on;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> server <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name  iad.turing.asia;
</span></span><span style=display:flex><span>  location / <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span><span style=color:#776e71>#è®¾ç½®çœŸå®ip</span>
</span></span><span style=display:flex><span>proxy_set_header real_ip <span style=color:#ef6155>$remote_addr</span>;
</span></span><span style=display:flex><span>proxy_pass http://dsp:8080;
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span> <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> server <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name  tag.turing.asia;
</span></span><span style=display:flex><span>  location / <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span><span style=color:#776e71>#è®¾ç½®çœŸå®ip</span>
</span></span><span style=display:flex><span>proxy_set_header real_ip <span style=color:#ef6155>$remote_addr</span>;
</span></span><span style=display:flex><span>proxy_pass http://tag:8080;
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span> <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> server <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name  cm.turing.asia;
</span></span><span style=display:flex><span>  location / <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span><span style=color:#776e71>#è®¾ç½®çœŸå®ip</span>
</span></span><span style=display:flex><span>proxy_set_header real_ip <span style=color:#ef6155>$remote_addr</span>;
</span></span><span style=display:flex><span> <span style=color:#776e71>#  proxy_redirect off;</span>
</span></span><span style=display:flex><span>proxy_pass http://cm:8080;
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span> <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h2 id=åŸºæœ¬é…ç½®>åŸºæœ¬é…ç½®</h2><h3 id=user>user</h3><ul><li>è¯­æ³•: user user [group]</li><li>ç¼ºçœå€¼: nobody nobody<br>æŒ‡å®šNginx Workerè¿›ç¨‹è¿è¡Œç”¨æˆ·ï¼Œé»˜è®¤æ˜¯nobodyå¸å·ã€‚</li></ul><h3 id=error_log>error_log</h3><ul><li>è¯­æ³•: error_log file [ debug | info | notice | warn | error | crit ]</li><li>ç¼ºçœå€¼: ${prefix}/logs/error.log<br>åˆ¶å®šé”™è¯¯æ—¥å¿—çš„å­˜æ”¾ä½ç½®å’Œçº§åˆ«ã€‚</li></ul><h3 id=worker_processes>worker_processes</h3><ul><li>è¯­æ³•: worker_processes number</li><li>ç¼ºçœå€¼: 1<br>æŒ‡å®šå·¥ä½œè¿›ç¨‹æ•°ã€‚nginxå¯ä»¥ä½¿ç”¨å¤šä¸ªworkerè¿›ç¨‹ã€‚</li></ul><h3 id=worker_cpu_affinity>worker_cpu_affinity</h3><ul><li>è¯­æ³•: 3.1.4.worker_cpu_affinity cpumask<br>æ‰§è¡ŒNginxåœ¨å“ªä¸ª/äº›CPUä¸Šå·¥ä½œï¼Œé»˜è®¤ç”±ç³»ç»Ÿæ¥ç®¡ï¼ˆå¯ä»¥åœ¨æ‰€æœ‰æ ¸å¿ƒä¸Šè¿è¡Œï¼‰ã€‚<br>å¦‚ï¼Œæœ‰8ä¸ªCPUçº¿ç¨‹ï¼ˆåŒ…æ‹¬è¶…çº¿ç¨‹ï¼‰ï¼ŒæŒ‡å®šä½¿ç”¨ç¬¬0ä¸ªCPUåˆ™é…ç½®ä¸º00000001ï¼ŒæŒ‡å®šä½¿ç”¨ç¬¬7å’Œç¬¬1ä¸ªCPUçº¿ç¨‹åˆ™é…ç½®ä¸º10000010ã€‚</li></ul><h2 id=eventæ¨¡å—>Eventæ¨¡å—</h2><p>Nginxçš„é»˜è®¤é…ç½®ä¸­åŒ…å«ä¸€ä¸ªé»˜è®¤çš„Eventæ¨¡å—ï¼Œå…¶ä¸­åªåŒ…å«worker_connectionsé…ç½®ã€‚</p><h3 id=worker_connections>worker_connections</h3><ul><li>è¯­æ³•ï¼šworker_connections number<br>æ¯ä¸ªworkerçš„æœ€å¤§è¿æ¥æ•°ã€‚é€šè¿‡worker_connectionså’Œworker_proceseså¯ä»¥è®¡ç®—å‡ºmaxclientsï¼š max_clients = worker_processes * worker_connectionsã€‚ä½œä¸ºåå‘ä»£ç†ï¼Œmax_clientsä¸ºï¼š max_clients = worker_processes * worker_connections/4ï¼Œå› ä¸ºæµè§ˆå™¨è®¿é—®æ—¶ä¼šé€šè¿‡è¿æ¥æ± å»ºç«‹å¤šä¸ªè¿æ¥ã€‚</li></ul><h2 id=httpæ¨¡å—>HTTPæ¨¡å—</h2><p>Nginxæœ€å¸¸ç”¨çš„æ˜¯HTTPæ¨¡å—ã€‚</p><h3 id=åŸºæœ¬é…ç½®-1>åŸºæœ¬é…ç½®</h3><p>HTTPä¸­å¤§éƒ¨åˆ†åŸºæœ¬é…ç½®æ— éœ€ä¿®æ”¹ï¼Œé™¤äº†ï¼š</p><ul><li>keepalive_timeout 1000;é…ç½®Keep-Aliveçš„è¶…æ—¶ï¼Œå•ä½ä¸ºç§’ï¼›</li><li>gzip on;é…ç½®æ˜¯å¦å¼€å¯Gzipå‹ç¼©ï¼Œå¼€å¯åå¯ä»¥æé«˜ç½‘ç«™è®¿é—®é€Ÿåº¦ï¼›</li><li>log_format é…ç½®æ—¥å¿—æ ¼å¼ï¼Œaccess_logé…ç½®æ—¥å¿—è·¯å¾„å’Œä½¿ç”¨çš„æ ¼å¼ï¼Œåœ¨æ­¤ä¸ç»†è¿°ã€‚</li></ul><h3 id=serverä½œç”¨åŸŸ>serverä½œç”¨åŸŸ</h3><p>HTTPæ¨¡å—ä¸­æœ€å¸¸é…ç½®çš„æ˜¯serverä½œç”¨åŸŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>server <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name  cm.turing.asia;
</span></span><span style=display:flex><span>  location / <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>#è®¾ç½®çœŸå®ip</span>
</span></span><span style=display:flex><span>    proxy_set_header real_ip <span style=color:#ef6155>$remote_addr</span>;
</span></span><span style=display:flex><span>    proxy_pass http://cm:8080;
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h4 id=listen>listen</h4><ul><li>è¯­æ³•: listen address:port</li><li>é»˜è®¤å€¼ï¼š listen 80</li><li>ä½œç”¨åŸŸ: server
æŒ‡å®šå½“å‰è™šæ‹Ÿæœºçš„ç›‘å¬ç«¯å£ã€‚</li></ul><h4 id=server_name>server_name</h4><p>å½“å‰serveråŒ¹é…çš„ç”¨æˆ·è¯·æ±‚è·¯å¾„çš„ä¸»æœºåï¼Œä¸»è¦ç”¨äºé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºï¼Œæ”¯æŒé€šé…ç¬¦<em>å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼ˆä»¥æ³¢æµªçº¿~èµ·å¤´ï¼‰ã€‚<br>server_nameæŒ‡ä»¤åœ¨æ¥åˆ°è¯·æ±‚åçš„åŒ¹é…é¡ºåºåˆ†åˆ«ä¸ºï¼šå‡†ç¡®çš„server_nameåŒ¹é…ï¼Œä»¥</em>é€šé…ç¬¦å¼€å§‹çš„å­—ç¬¦ä¸²ï¼Œä»¥<em>é€šé…ç¬¦ç»“æŸçš„å­—ç¬¦ä¸²ã€åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚nginxæŒ‰ä»¥ä¸Šé¡ºåºä¾æ¬¡åŒ¹é…ï¼Œåªè¦æœ‰ä¸€é¡¹åŒ¹é…ä»¥åå°±ä¼šåœæ­¢æœç´¢ã€‚<br>ä¸¾ä¾‹ï¼š å…ˆåé…ç½®äº†ä¸¤ä¸ªserverï¼Œ server_nameåˆ†åˆ«é…ç½®ä¸ºcm.turing.asiaå’Œ</em>.turing.asiaï¼Œå½“ç”¨æˆ·è¯·æ±‚cm.turing.asiaæ—¶ï¼Œè®¿é—®ç¬¬ä¸€ä¸ªserverï¼Œç”¨æˆ·è®¿é—®test.turing.asiaæ—¶è®¿é—®ç¬¬äºŒä¸ªserverã€‚</p><h4 id=location>location</h4><ul><li>è¯­æ³•ï¼šlocation åŒ¹é…å­—ç¬¦ä¸² { æ“ä½œè¯­å¥ }</li></ul><p>ä¸€ä¸ªserverä¸­å¯ä»¥æœ‰å¤šä¸ªlocationï¼Œç”¨äºåŒ¹é…è¯·æ±‚è·¯å¾„ã€‚<br>åŒ¹é…çš„ä¼˜å…ˆçº§ä¸server_nameç›¸åŒã€‚<br>locationçš„æ“ä½œè¯­å¥ä¸­ï¼š<br>å¯ä»¥ç”¨proxy_set_headerè®¾å®š/å¢åŠ HTTPè¯·æ±‚å¤´ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç”¨proxy_set_header real_ip $remote_addr;å°†è¿œç¨‹ä¸»æœºçš„çœŸå®IPåŠ åˆ°HTTPè¯·æ±‚å¤´çš„real_ipå­—æ®µä¸­ï¼Œå› ä¸ºæ”¶åˆ°Nginxè½¬å‘çš„æœåŠ¡å™¨è¯»å–åˆ°çš„è¿œç¨‹ä¸»æœºIPä¸ºNginxçš„IPï¼Œä¸¢å¤±äº†çœŸå®çš„ç”¨æˆ·IPä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨æ­¤åŠ ä¸Šã€‚</p><p>locationä¸­è¿˜å¯ä»¥ä½¿ç”¨ifè¯­å¥ç»“åˆæ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè¯·æ±‚çš„åˆ¤æ–­ï¼Œæ¯”å¦‚æ ¹æ®è¯·æ±‚ä¸­çš„Referå’Œè¯·æ±‚èµ„æºç±»å‹ï¼Œä½¿ç”¨<strong>valid_referers</strong>ç¦ç”¨å¤–ç«™Referçš„å›¾ç‰‡èµ„æºè¯·æ±‚ï¼Œä»¥å®ç°é˜²ç›—é“¾ï¼Œåœ¨æ­¤ä¸ç»†è¿°ã€‚<br>æ›´å¸¸ç”¨çš„æ˜¯proxy_pass ä½œåå‘ä»£ç†ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ã€‚<br>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå› ä¸ºåŒä¸€å°TomcatæœåŠ¡å™¨ä¸­æœ‰å¤šä¸ªé¡¹ç›®ï¼Œè€Œç»è¿‡Nginxè½¬å‘çš„è¯·æ±‚ï¼Œä¼šå°†è¯·æ±‚çš„ä¸»æœºæ›¿ä»£ä¸ºproxy_passä¸­é…ç½®çš„ä¸»æœºï¼Œæ‰€ä»¥å¦‚æœproxy_passä¸­å¡«å†™çš„æ˜¯TomcatæœåŠ¡å™¨çš„å†…ç½‘åœ°å€ï¼Œåˆ™Tomcatæ— æ³•åˆ†è¾¨ç”¨æˆ·åŸæœ¬æƒ³è®¿é—®çš„åŸŸåï¼Œäº¦å³éš¾ä»¥åœ¨server.xmlä¸­é…ç½®ä¸åŒçš„åŸŸåç»‘å®šä¸åŒé¡¹ç›®ã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨Nginxçš„æœåŠ¡å™¨ä¸­é…ç½®hostsï¼Œå°†å¤šä¸ªè‡ªå®šä¹‰çš„ä¸»æœºåç»‘å®šåˆ°TomcatæœåŠ¡å™¨çš„IPä¸­ï¼›åŒæ—¶ï¼Œåœ¨Nginxçš„é…ç½®ä¸­ï¼Œlocationçš„proxy_passä¸å†é…ç½®ä¸ºTomcatæœåŠ¡å™¨çš„IPè€Œæ˜¯hostsä¸­æˆ‘ä»¬è®¾å®šçš„server_nameå¯¹åº”çš„ä¸»æœºåã€‚æœ€åTomcatçš„server.xmlä¹Ÿç›¸åº”åœ°é…ç½®HostèŠ‚ç‚¹çš„nameå±æ€§ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#776e71>&lt;!--TomcatæœåŠ¡å™¨çš„server.xml ç‰‡æ®µï¼š--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>&lt;Host</span> <span style=color:#06b6ef>name=</span><span style=color:#48b685>&#34;cm&#34;</span>  <span style=color:#06b6ef>appBase=</span><span style=color:#48b685>&#34;cmserv&#34;</span> <span style=color:#06b6ef>unpackWARs=</span><span style=color:#48b685>&#34;true&#34;</span> <span style=color:#06b6ef>autoDeploy=</span><span style=color:#48b685>&#34;true&#34;</span><span style=color:#5bc4bf>&gt;</span>
</span></span><span style=display:flex><span>ã€€ã€€<span style=color:#5bc4bf>&lt;Context</span> <span style=color:#06b6ef>path=</span><span style=color:#48b685>&#34;turingcm&#34;</span> <span style=color:#06b6ef>docBase=</span><span style=color:#48b685>&#34;turingcm&#34;</span> <span style=color:#06b6ef>reloadable=</span><span style=color:#48b685>&#34;true&#34;</span> <span style=color:#5bc4bf>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>&lt;/Host&gt;</span>
</span></span></code></pre></div><h2 id=è´Ÿè½½å‡è¡¡é…ç½®>è´Ÿè½½å‡è¡¡é…ç½®</h2><p>é¦–å…ˆåœ¨HTTPæ¨¡å—ä¸­å®šä¹‰å¤šå°æœåŠ¡å™¨æ„æˆçš„è´Ÿè½½å‡è¡¡ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>upstream rtb<span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>  server 127.0.0.1:8080 <span style=color:#ef6155>weight</span><span style=color:#5bc4bf>=</span>5;
</span></span><span style=display:flex><span>  server 127.0.0.1:8081 <span style=color:#ef6155>weight</span><span style=color:#5bc4bf>=</span>5;
</span></span><span style=display:flex><span>  â€¦â€¦â€¦â€¦
</span></span><span style=display:flex><span>  server 127.0.0.1:8085 backup;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><p>æ¯å°æœåŠ¡å™¨ä¸ºä¸€è¡Œï¼Œå¡«å†™IPå’Œç«¯å£ï¼Œå¹¶åœ¨weightä¸­å¡«å…¥è´Ÿè½½å‡è¡¡çš„æƒé‡ï¼ˆæ­£æ•´æ•°ï¼Œé»˜è®¤ä¸º1ï¼‰ï¼Œæ³¨æ„åˆ†å·ã€‚ä»¥ä¸Šä¾‹å­å°†è¯¥è´Ÿè½½å‡è¡¡é…ç½®å‘½åä¸ºâ€rtbâ€ã€‚IPå’Œç«¯å£åé¢å¡«backupçš„è¡¨ç¤ºå¤‡ç”¨æœåŠ¡å™¨ï¼Œå½“å…¶ä»–ébackupçš„æœåŠ¡å™¨å‡å¿™æˆ–å®•æœºæ—¶ï¼Œä¼šåˆ†å‘è¯·æ±‚åˆ°backupæœåŠ¡å™¨ä¸Šã€‚<br>ç„¶ååœ¨locationä¸­ï¼Œé…ç½®<strong>proxy_pass http://[è´Ÿè½½å‡è¡¡å];</strong> å³å¯ï¼Œå³è¯¥serverå’Œlocationå®šä¹‰çš„åŸŸåè§„åˆ™å’Œè®¿é—®è·¯å¾„è§„åˆ™åŒ¹é…åˆ°çš„è¯·æ±‚å°†æŒ‰weightåˆ†å‘åˆ°ä»¥ä¸Šå‡ å°æœåŠ¡å™¨/æœåŠ¡ä¸­ã€‚</p><h2 id=åŠ¨é™åˆ†ç¦»>åŠ¨é™åˆ†ç¦»</h2><p>tomcatæ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„webå®¹å™¨ï¼Œå¯¹é™æ€ç½‘é¡µçš„å¤„ç†ï¼Œåº”è¯¥æ˜¯æ¯”è¾ƒè´¹èµ„æºçš„ï¼Œç‰¹åˆ«æ˜¯æ¯æ¬¡éƒ½è¦ä»ç£ç›˜è¯»å–é™æ€é¡µé¢ï¼Œç„¶åè¿”å›ã€‚è¿™ä¸­é—´ä¼šæ¶ˆè€—Tomcatçš„èµ„æºï¼Œå¯èƒ½ä¼šä½¿é‚£äº›åŠ¨æ€é¡µé¢è§£ææ€§èƒ½å½±å“ã€‚</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>//é™æ€èµ„æº    
</span></span><span style=display:flex><span>location ~ .*<span style=color:#f99b15>\.</span><span style=color:#5bc4bf>(</span>js|css|htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma<span style=color:#5bc4bf>)</span>$ <span style=color:#5bc4bf>{</span> //é™æ€èµ„æºåˆ°nginxæœåŠ¡å™¨ä¸‹staticè·å–
</span></span><span style=display:flex><span>     root static;
</span></span><span style=display:flex><span>     expires 30d; //è®¾ç½®ç¼“å­˜æœŸé™
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span> //åŠ¨æ€èµ„æº
</span></span><span style=display:flex><span> location ~ .*$ <span style=color:#5bc4bf>{</span> //åŠ¨æ€è¯·æ±‚è½¬å‘åˆ°tomcatæœåŠ¡å™¨
</span></span><span style=display:flex><span>    proxy_pass http://127.0.0.1:8080;
</span></span><span style=display:flex><span> <span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><p>åŠ¨é™åˆ†ç¦»çš„åŸç†ï¼šNginxé…ç½®ä¸­ï¼Œé€šè¿‡locationçš„é…ç½®ï¼Œç»“åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ ¹æ®è¯·æ±‚è·¯å¾„åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦é™æ€èµ„æºï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€šè¿‡** root static;** é…ç½®ç›´æ¥è¯»å–/usr/local/nginx/staticä¸‹é¢å¯¹åº”ç›¸å¯¹è·¯å¾„çš„èµ„æºã€‚å¦‚æœæ˜¯jspç­‰åŠ¨æ€èµ„æºï¼Œåˆ™è½¬å‘åˆ°TomcatæœåŠ¡å™¨ã€‚<br>æ³¨æ„ï¼Œå¯ä»¥ä½¿ç”¨** root [ç»å¯¹è·¯å¾„];**ï¼Œ ä¸ä¸€å®šè¦å°†é™æ€èµ„æºæ”¾åœ¨Nginxç›®å½•ä¸‹ã€‚
è¿™é‡Œå°†é™æ€èµ„æºçš„locationæ”¾åœ¨å‰é¢ä¼˜å…ˆåŒ¹é…ï¼ˆåŒæ ·æ˜¯æ­£åˆ™åŒ¹é…çš„æƒ…å†µä¸‹ï¼‰ã€‚<br>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸åŒçš„æ­£åˆ™å¯¹ä¸åŒçš„é™æ€èµ„æºç±»å‹é…ç½®ä¸åŒçš„ç¼“å­˜æœŸé™ï¼Œå¦‚åˆ›æ„ç­‰å›¾ç‰‡å¯èƒ½ä¼šå˜åŠ¨ï¼Œç¼“å­˜æœŸé™è®¾å°ä¸€ç‚¹ï¼Œè€Œjs/cssç­‰é™æ€èµ„æºåŸºæœ¬ä¸å˜ï¼Œç¼“å­˜æœŸé™å¯ä»¥è®¾é•¿ä¸€ç‚¹ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/Nginx/>Nginx</a>
<a href=/tags/%E5%B9%B6%E5%8F%91/>å¹¶å‘</a>
<a href=/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/>è´Ÿè½½å‡è¡¡</a>
<a href=/tags/%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/>åŠ¨é™åˆ†ç¦»</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under Apache License 2.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//leibnizhu.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2016 -
2022 Heaven's Door</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ç®€ä»‹>ç®€ä»‹</a></li><li><a href=#åŸºç¡€åŠŸèƒ½>åŸºç¡€åŠŸèƒ½</a></li><li><a href=#ä¼˜åŠ¿>ä¼˜åŠ¿</a></li></ol><ol><li><a href=#ä¸‹è½½>ä¸‹è½½</a></li><li><a href=#ç¯å¢ƒå‡†å¤‡>ç¯å¢ƒå‡†å¤‡</a></li><li><a href=#ç¼–è¯‘å®‰è£…>ç¼–è¯‘å®‰è£…</a></li><li><a href=#å¯åŠ¨å…³é—­>å¯åŠ¨&å…³é—­</a><ol><li><a href=#å¯åŠ¨>å¯åŠ¨</a></li><li><a href=#é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</a></li><li><a href=#å…³é—­>å…³é—­</a></li></ol></li></ol><ol><li><a href=#åŸºæœ¬é…ç½®>åŸºæœ¬é…ç½®</a><ol><li><a href=#user>user</a></li><li><a href=#error_log>error_log</a></li><li><a href=#worker_processes>worker_processes</a></li><li><a href=#worker_cpu_affinity>worker_cpu_affinity</a></li></ol></li><li><a href=#eventæ¨¡å—>Eventæ¨¡å—</a><ol><li><a href=#worker_connections>worker_connections</a></li></ol></li><li><a href=#httpæ¨¡å—>HTTPæ¨¡å—</a><ol><li><a href=#åŸºæœ¬é…ç½®-1>åŸºæœ¬é…ç½®</a></li><li><a href=#serverä½œç”¨åŸŸ>serverä½œç”¨åŸŸ</a><ol><li><a href=#listen>listen</a></li><li><a href=#server_name>server_name</a></li><li><a href=#location>location</a></li></ol></li></ol></li><li><a href=#è´Ÿè½½å‡è¡¡é…ç½®>è´Ÿè½½å‡è¡¡é…ç½®</a></li><li><a href=#åŠ¨é™åˆ†ç¦»>åŠ¨é™åˆ†ç¦»</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>