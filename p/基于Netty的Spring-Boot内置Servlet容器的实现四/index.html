<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰ Registrationæ³¨å†Œå™¨çš„å®ç° è®¾è®¡ä¸ç»§æ‰¿ç»“æ„ åœ¨æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æåˆ°äº†javax.servlet.Registrationæ¥å£ï¼Œç”¨äºå®ç°Filterå’ŒServletçš„åŠ¨æ€æ³¨å†Œï¼Œè¿™ä¸ªæ¥å£ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼›æœ‰ä¸¤ä¸ªå­æ¥å£ï¼Œè¯¦è§ä¸‹é¢çš„UMLå›¾ï¼š
æˆ‘ä»¬å°†è¦åˆ†åˆ«å®ç°FilterRegistrationå’ŒServletRegistrationæ¥å£ï¼Œä¸ºäº†ä¿æŒä¸Registrationæ¥å£çš„ç»§æ‰¿å…³ç³»ç›¸è¿‘ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸‰ä¸ªç±»ï¼Œåˆ†åˆ«æ˜¯æŠ½è±¡ç±»ï¼ŒFilteræ³¨å†Œã€Servletæ³¨å†Œï¼š
class AbstractNettyRegistration implements Registration, Registration.Dynamic, ServletConfig, FilterConfig{} public class NettyFilterRegistration extends AbstractNettyRegistration implements FilterRegistration.Dynamic{} public class NettyServletRegistration extends AbstractNettyRegistration implements ServletRegistration.Dynamic{} è¿™äº›ç±»æ„æˆçš„UMLå›¾å¦‚ä¸‹ï¼š
ä»£ç å®ç° åœ¨å®é™…å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¿½ç•¥äº†å¾ˆå¤šç”¨ä¸åˆ°çš„æ–¹æ³•ï¼Œç€é‡å®ç°äº†åŠ å…¥Mappingä»¥åŠè·å–Filter/Servletå®ä¾‹çš„æ–¹æ³•ã€‚
åŠ å…¥Mappingçš„æ–¹æ³•ç”±ServletContextå¤„ç†ï¼ˆMappingæœ¬èº«ä¹Ÿæ˜¯ç”±ServletContextç»´æŠ¤ï¼‰ï¼Œè€Œè·å–Filter/Servletçš„æ–¹æ³•ä½¿ç”¨çš„æ˜¯ç±»ä¼¼äºæ‡’åŠ è½½å•ä¾‹çš„æ–¹æ³•ï¼Œæ¯ä¸ªRegistrationå®ä¾‹ç»´æŠ¤è‡ªå·±çš„ä¸€ä¸ªFilter/Servletå®ä¾‹ï¼Œé¦–æ¬¡è·å–çš„æ—¶å€™é€šè¿‡åå°„è·å–åˆ°å®ä¾‹ï¼Œå¹¶å°†åå°„è·å–åˆ°çš„å®ä¾‹ç”±Registrationå®ä¾‹æŒæœ‰ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š
public class NettyServletRegistration extends AbstractNettyRegistration implements ServletRegistration.Dynamic {  private final Logger log = LoggerFactory.getLogger(getClass());  private volatile boolean initialised;  private Servlet servlet;  private Collection&amp;lt;String&amp;gt; urlPatternMappings = new LinkedList&amp;lt;&amp;gt;();   public NettyServletRegistration(NettyContext context, String servletName, String className, Servlet servlet) {  super(servletName, className, context);  this."><title>åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰</title><link rel=canonical href=https://leibnizhu.github.io/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/><link rel=stylesheet href=/scss/style.min.f6e1f9fc3ff66a58601c08d5ce96493eafb5f1b936be2f7b2eacd3e7784f2f38.css><meta property="og:title" content="åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰"><meta property="og:description" content="åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰ Registrationæ³¨å†Œå™¨çš„å®ç° è®¾è®¡ä¸ç»§æ‰¿ç»“æ„ åœ¨æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æåˆ°äº†javax.servlet.Registrationæ¥å£ï¼Œç”¨äºå®ç°Filterå’ŒServletçš„åŠ¨æ€æ³¨å†Œï¼Œè¿™ä¸ªæ¥å£ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼›æœ‰ä¸¤ä¸ªå­æ¥å£ï¼Œè¯¦è§ä¸‹é¢çš„UMLå›¾ï¼š
æˆ‘ä»¬å°†è¦åˆ†åˆ«å®ç°FilterRegistrationå’ŒServletRegistrationæ¥å£ï¼Œä¸ºäº†ä¿æŒä¸Registrationæ¥å£çš„ç»§æ‰¿å…³ç³»ç›¸è¿‘ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸‰ä¸ªç±»ï¼Œåˆ†åˆ«æ˜¯æŠ½è±¡ç±»ï¼ŒFilteræ³¨å†Œã€Servletæ³¨å†Œï¼š
class AbstractNettyRegistration implements Registration, Registration.Dynamic, ServletConfig, FilterConfig{} public class NettyFilterRegistration extends AbstractNettyRegistration implements FilterRegistration.Dynamic{} public class NettyServletRegistration extends AbstractNettyRegistration implements ServletRegistration.Dynamic{} è¿™äº›ç±»æ„æˆçš„UMLå›¾å¦‚ä¸‹ï¼š
ä»£ç å®ç° åœ¨å®é™…å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¿½ç•¥äº†å¾ˆå¤šç”¨ä¸åˆ°çš„æ–¹æ³•ï¼Œç€é‡å®ç°äº†åŠ å…¥Mappingä»¥åŠè·å–Filter/Servletå®ä¾‹çš„æ–¹æ³•ã€‚
åŠ å…¥Mappingçš„æ–¹æ³•ç”±ServletContextå¤„ç†ï¼ˆMappingæœ¬èº«ä¹Ÿæ˜¯ç”±ServletContextç»´æŠ¤ï¼‰ï¼Œè€Œè·å–Filter/Servletçš„æ–¹æ³•ä½¿ç”¨çš„æ˜¯ç±»ä¼¼äºæ‡’åŠ è½½å•ä¾‹çš„æ–¹æ³•ï¼Œæ¯ä¸ªRegistrationå®ä¾‹ç»´æŠ¤è‡ªå·±çš„ä¸€ä¸ªFilter/Servletå®ä¾‹ï¼Œé¦–æ¬¡è·å–çš„æ—¶å€™é€šè¿‡åå°„è·å–åˆ°å®ä¾‹ï¼Œå¹¶å°†åå°„è·å–åˆ°çš„å®ä¾‹ç”±Registrationå®ä¾‹æŒæœ‰ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š
public class NettyServletRegistration extends AbstractNettyRegistration implements ServletRegistration.Dynamic {  private final Logger log = LoggerFactory.getLogger(getClass());  private volatile boolean initialised;  private Servlet servlet;  private Collection&amp;lt;String&amp;gt; urlPatternMappings = new LinkedList&amp;lt;&amp;gt;();   public NettyServletRegistration(NettyContext context, String servletName, String className, Servlet servlet) {  super(servletName, className, context);  this."><meta property="og:url" content="https://leibnizhu.github.io/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/"><meta property="og:site_name" content="Heaven's Door"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Netty"><meta property="article:tag" content="Spring Boot"><meta property="article:tag" content="Servlet"><meta property="article:published_time" content="2017-09-02T15:11:03+00:00"><meta property="article:modified_time" content="2017-09-02T15:11:03+00:00"><meta property="og:image" content="https://leibnizhu.github.io/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/jinjia.png"><meta name=twitter:title content="åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰"><meta name=twitter:description content="åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰ Registrationæ³¨å†Œå™¨çš„å®ç° è®¾è®¡ä¸ç»§æ‰¿ç»“æ„ åœ¨æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æåˆ°äº†javax.servlet.Registrationæ¥å£ï¼Œç”¨äºå®ç°Filterå’ŒServletçš„åŠ¨æ€æ³¨å†Œï¼Œè¿™ä¸ªæ¥å£ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼›æœ‰ä¸¤ä¸ªå­æ¥å£ï¼Œè¯¦è§ä¸‹é¢çš„UMLå›¾ï¼š
æˆ‘ä»¬å°†è¦åˆ†åˆ«å®ç°FilterRegistrationå’ŒServletRegistrationæ¥å£ï¼Œä¸ºäº†ä¿æŒä¸Registrationæ¥å£çš„ç»§æ‰¿å…³ç³»ç›¸è¿‘ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸‰ä¸ªç±»ï¼Œåˆ†åˆ«æ˜¯æŠ½è±¡ç±»ï¼ŒFilteræ³¨å†Œã€Servletæ³¨å†Œï¼š
class AbstractNettyRegistration implements Registration, Registration.Dynamic, ServletConfig, FilterConfig{} public class NettyFilterRegistration extends AbstractNettyRegistration implements FilterRegistration.Dynamic{} public class NettyServletRegistration extends AbstractNettyRegistration implements ServletRegistration.Dynamic{} è¿™äº›ç±»æ„æˆçš„UMLå›¾å¦‚ä¸‹ï¼š
ä»£ç å®ç° åœ¨å®é™…å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¿½ç•¥äº†å¾ˆå¤šç”¨ä¸åˆ°çš„æ–¹æ³•ï¼Œç€é‡å®ç°äº†åŠ å…¥Mappingä»¥åŠè·å–Filter/Servletå®ä¾‹çš„æ–¹æ³•ã€‚
åŠ å…¥Mappingçš„æ–¹æ³•ç”±ServletContextå¤„ç†ï¼ˆMappingæœ¬èº«ä¹Ÿæ˜¯ç”±ServletContextç»´æŠ¤ï¼‰ï¼Œè€Œè·å–Filter/Servletçš„æ–¹æ³•ä½¿ç”¨çš„æ˜¯ç±»ä¼¼äºæ‡’åŠ è½½å•ä¾‹çš„æ–¹æ³•ï¼Œæ¯ä¸ªRegistrationå®ä¾‹ç»´æŠ¤è‡ªå·±çš„ä¸€ä¸ªFilter/Servletå®ä¾‹ï¼Œé¦–æ¬¡è·å–çš„æ—¶å€™é€šè¿‡åå°„è·å–åˆ°å®ä¾‹ï¼Œå¹¶å°†åå°„è·å–åˆ°çš„å®ä¾‹ç”±Registrationå®ä¾‹æŒæœ‰ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š
public class NettyServletRegistration extends AbstractNettyRegistration implements ServletRegistration.Dynamic {  private final Logger log = LoggerFactory.getLogger(getClass());  private volatile boolean initialised;  private Servlet servlet;  private Collection&amp;lt;String&amp;gt; urlPatternMappings = new LinkedList&amp;lt;&amp;gt;();   public NettyServletRegistration(NettyContext context, String servletName, String className, Servlet servlet) {  super(servletName, className, context);  this."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leibnizhu.github.io/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/jinjia.png"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu4af873b90feb2f44d14cf5fcf42d034c_7593_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸŸ</span></figure><div class=site-meta><h1 class=site-name><a href=/>Heaven's Door</a></h1><h2 class=site-description>That cold black cloud is comin' down, Feels like I'm knockin' on heaven's doorâ€¦</h2></div></header><ol class=social-menu><li><a href=mailto:leibnizhu@gmail.com target=_blank title=Email><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-gmail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=https://github.com/leibnizhu target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://leibnizhu.github.io target=_blank title=Home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg></a></li><li><a href=https://leibnizhu.github.io/running target=_blank title=Running><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-run" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="13" cy="4" r="1"/><path d="M4 17l5 1 .75-1.5"/><path d="M15 21v-4l-4-3 1-6"/><path d="M7 12V9l5-1 3 3 3 1"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/About/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/Links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/><img src=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/jinjia_hu26351fb12c0954f3f1a41e5c79a350f9_35320_800x0_resize_box_3.png srcset="/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/jinjia_hu26351fb12c0954f3f1a41e5c79a350f9_35320_800x0_resize_box_3.png 800w, /p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/jinjia_hu26351fb12c0954f3f1a41e5c79a350f9_35320_1600x0_resize_box_3.png 1600w" width=800 height=318 loading=lazy alt="Featured image of post åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/>åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 02, 2017</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h1 id=åŸºäºnettyçš„spring-bootå†…ç½®servletå®¹å™¨çš„å®ç°å››>åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆå››ï¼‰</h1><h2 id=registrationæ³¨å†Œå™¨çš„å®ç°>Registrationæ³¨å†Œå™¨çš„å®ç°</h2><h3 id=è®¾è®¡ä¸ç»§æ‰¿ç»“æ„>è®¾è®¡ä¸ç»§æ‰¿ç»“æ„</h3><p>åœ¨æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æåˆ°äº†<code>javax.servlet.Registration</code>æ¥å£ï¼Œç”¨äºå®ç°Filterå’ŒServletçš„åŠ¨æ€æ³¨å†Œï¼Œè¿™ä¸ªæ¥å£ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼›æœ‰ä¸¤ä¸ªå­æ¥å£ï¼Œè¯¦è§ä¸‹é¢çš„UMLå›¾ï¼š<br><img src=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/registration.png width=332 height=119 srcset="/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/registration_hu831b4d4bf95df234e4449ae778439cb1_7670_480x0_resize_box_3.png 480w, /p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/registration_hu831b4d4bf95df234e4449ae778439cb1_7670_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=278 data-flex-basis=669px><br>æˆ‘ä»¬å°†è¦åˆ†åˆ«å®ç°<code>FilterRegistration</code>å’Œ<code>ServletRegistration</code>æ¥å£ï¼Œä¸ºäº†ä¿æŒä¸<code>Registration</code>æ¥å£çš„ç»§æ‰¿å…³ç³»ç›¸è¿‘ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸‰ä¸ªç±»ï¼Œåˆ†åˆ«æ˜¯æŠ½è±¡ç±»ï¼ŒFilteræ³¨å†Œã€Servletæ³¨å†Œï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>class</span> <span style=color:#fec418>AbstractNettyRegistration</span> <span style=color:#815ba4>implements</span> Registration<span style=color:#5bc4bf>,</span> Registration<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Dynamic</span><span style=color:#5bc4bf>,</span> ServletConfig<span style=color:#5bc4bf>,</span> FilterConfig<span style=color:#5bc4bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>NettyFilterRegistration</span> <span style=color:#815ba4>extends</span> AbstractNettyRegistration <span style=color:#815ba4>implements</span> FilterRegistration<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Dynamic</span><span style=color:#5bc4bf>{}</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>NettyServletRegistration</span> <span style=color:#815ba4>extends</span> AbstractNettyRegistration <span style=color:#815ba4>implements</span> ServletRegistration<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Dynamic</span><span style=color:#5bc4bf>{}</span>
</span></span></code></pre></div><p>è¿™äº›ç±»æ„æˆçš„UMLå›¾å¦‚ä¸‹ï¼š<br><img src=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/nettyregistration.png width=763 height=305 srcset="/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/nettyregistration_hu06c2b308d87ab306685ce16afaf10d4e_20515_480x0_resize_box_3.png 480w, /p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9B%9B/nettyregistration_hu06c2b308d87ab306685ce16afaf10d4e_20515_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=250 data-flex-basis=600px></p><h3 id=ä»£ç å®ç°>ä»£ç å®ç°</h3><p>åœ¨å®é™…å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå¿½ç•¥äº†å¾ˆå¤šç”¨ä¸åˆ°çš„æ–¹æ³•ï¼Œç€é‡å®ç°äº†åŠ å…¥Mappingä»¥åŠè·å–Filter/Servletå®ä¾‹çš„æ–¹æ³•ã€‚<br>åŠ å…¥Mappingçš„æ–¹æ³•ç”±ServletContextå¤„ç†ï¼ˆMappingæœ¬èº«ä¹Ÿæ˜¯ç”±ServletContextç»´æŠ¤ï¼‰ï¼Œè€Œè·å–Filter/Servletçš„æ–¹æ³•ä½¿ç”¨çš„æ˜¯ç±»ä¼¼äºæ‡’åŠ è½½å•ä¾‹çš„æ–¹æ³•ï¼Œæ¯ä¸ªRegistrationå®ä¾‹ç»´æŠ¤è‡ªå·±çš„ä¸€ä¸ªFilter/Servletå®ä¾‹ï¼Œé¦–æ¬¡è·å–çš„æ—¶å€™é€šè¿‡åå°„è·å–åˆ°å®ä¾‹ï¼Œå¹¶å°†åå°„è·å–åˆ°çš„å®ä¾‹ç”±Registrationå®ä¾‹æŒæœ‰ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>NettyServletRegistration</span> <span style=color:#815ba4>extends</span> AbstractNettyRegistration <span style=color:#815ba4>implements</span> ServletRegistration<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Dynamic</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#815ba4>final</span> Logger log <span style=color:#5bc4bf>=</span> LoggerFactory<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getLogger</span><span style=color:#5bc4bf>(</span>getClass<span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#815ba4>volatile</span> <span style=color:#fec418>boolean</span> initialised<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> Servlet servlet<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> Collection<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>&gt;</span> urlPatternMappings <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> LinkedList<span style=color:#5bc4bf>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#06b6ef>NettyServletRegistration</span><span style=color:#5bc4bf>(</span>NettyContext context<span style=color:#5bc4bf>,</span> String servletName<span style=color:#5bc4bf>,</span> String className<span style=color:#5bc4bf>,</span> Servlet servlet<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>super</span><span style=color:#5bc4bf>(</span>servletName<span style=color:#5bc4bf>,</span> className<span style=color:#5bc4bf>,</span> context<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>servlet</span> <span style=color:#5bc4bf>=</span> servlet<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> Servlet <span style=color:#06b6ef>getServlet</span><span style=color:#5bc4bf>()</span> <span style=color:#815ba4>throws</span> ServletException <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(!</span>initialised<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>synchronized</span> <span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(!</span>initialised<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span><span style=color:#815ba4>null</span> <span style=color:#5bc4bf>==</span> servlet<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                        <span style=color:#815ba4>try</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                            servlet <span style=color:#5bc4bf>=</span> <span style=color:#5bc4bf>(</span>Servlet<span style=color:#5bc4bf>)</span> Class<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>forName</span><span style=color:#5bc4bf>(</span>getClassName<span style=color:#5bc4bf>()).</span><span style=color:#06b6ef>newInstance</span><span style=color:#5bc4bf>();</span> <span style=color:#776e71>//åå°„è·å–å®ä¾‹
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>                        <span style=color:#5bc4bf>}</span> <span style=color:#815ba4>catch</span> <span style=color:#5bc4bf>(</span>Exception e<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                            <span style=color:#815ba4>throw</span> <span style=color:#815ba4>new</span> ServletException<span style=color:#5bc4bf>(</span>e<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>                    servlet<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>init</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>);</span> <span style=color:#776e71>//åˆå§‹åŒ–Servlet
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>                    initialised <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>                <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>            <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> servlet<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> Set<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>&gt;</span> <span style=color:#06b6ef>addMapping</span><span style=color:#5bc4bf>(</span>String<span style=color:#5bc4bf>...</span> urlPatterns<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#776e71>//åœ¨RequestUrlPatternMapperä¸­ä¼šæ£€æŸ¥url Patternæ˜¯å¦å†²çª
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>        NettyContext context <span style=color:#5bc4bf>=</span> getNettyContext<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>for</span> <span style=color:#5bc4bf>(</span>String urlPattern <span style=color:#5bc4bf>:</span> urlPatterns<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>try</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                context<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>addServletMapping</span><span style=color:#5bc4bf>(</span>urlPattern<span style=color:#5bc4bf>,</span> getName<span style=color:#5bc4bf>(),</span> getServlet<span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>            <span style=color:#5bc4bf>}</span> <span style=color:#815ba4>catch</span> <span style=color:#5bc4bf>(</span>ServletException e<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                log<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>error</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;Throwing exception when getting Servlet in NettyServletRegistration.&#34;</span><span style=color:#5bc4bf>,</span> e<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        urlPatternMappings<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>addAll</span><span style=color:#5bc4bf>(</span>Arrays<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>asList</span><span style=color:#5bc4bf>(</span>urlPatterns<span style=color:#5bc4bf>));</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> <span style=color:#815ba4>new</span> HashSet<span style=color:#5bc4bf>&lt;&gt;(</span>urlPatternMappings<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>NettyFilterRegistration</span> <span style=color:#815ba4>extends</span> AbstractNettyRegistration <span style=color:#815ba4>implements</span> FilterRegistration<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Dynamic</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#815ba4>volatile</span> <span style=color:#fec418>boolean</span> initialised<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> Filter filter<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> Collection<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>&gt;</span> urlPatternMappings <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> LinkedList<span style=color:#5bc4bf>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#06b6ef>NettyFilterRegistration</span><span style=color:#5bc4bf>(</span>NettyContext context<span style=color:#5bc4bf>,</span> String filterName<span style=color:#5bc4bf>,</span> String className<span style=color:#5bc4bf>,</span> Filter filter<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>super</span><span style=color:#5bc4bf>(</span>filterName<span style=color:#5bc4bf>,</span> className<span style=color:#5bc4bf>,</span> context<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>filter</span> <span style=color:#5bc4bf>=</span> filter<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> Filter <span style=color:#06b6ef>getFilter</span><span style=color:#5bc4bf>()</span> <span style=color:#815ba4>throws</span> ServletException <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(!</span>initialised<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>synchronized</span> <span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(!</span>initialised<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span><span style=color:#815ba4>null</span> <span style=color:#5bc4bf>==</span> filter<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                        <span style=color:#815ba4>try</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                            filter <span style=color:#5bc4bf>=</span> <span style=color:#5bc4bf>(</span>Filter<span style=color:#5bc4bf>)</span> Class<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>forName</span><span style=color:#5bc4bf>(</span>getClassName<span style=color:#5bc4bf>()).</span><span style=color:#06b6ef>newInstance</span><span style=color:#5bc4bf>();</span> <span style=color:#776e71>//åå°„è·å–å®ä¾‹
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>                        <span style=color:#5bc4bf>}</span> <span style=color:#815ba4>catch</span> <span style=color:#5bc4bf>(</span>Exception e<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                            <span style=color:#815ba4>throw</span> <span style=color:#815ba4>new</span> ServletException<span style=color:#5bc4bf>(</span>e<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>                    filter<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>init</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>);</span> <span style=color:#776e71>//åˆå§‹åŒ–Filter
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>                    initialised <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>                <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>            <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> filter<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>addMappingForUrlPatterns</span><span style=color:#5bc4bf>(</span>EnumSet<span style=color:#5bc4bf>&lt;</span>DispatcherType<span style=color:#5bc4bf>&gt;</span> dispatcherTypes<span style=color:#5bc4bf>,</span> <span style=color:#fec418>boolean</span> isMatchAfter<span style=color:#5bc4bf>,</span> String<span style=color:#5bc4bf>...</span> urlPatterns<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        NettyContext context <span style=color:#5bc4bf>=</span> getNettyContext<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>for</span> <span style=color:#5bc4bf>(</span>String urlPattern <span style=color:#5bc4bf>:</span> urlPatterns<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            context<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>addFilterMapping</span><span style=color:#5bc4bf>(</span>dispatcherTypes<span style=color:#5bc4bf>,</span> isMatchAfter<span style=color:#5bc4bf>,</span> urlPattern<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        urlPatternMappings<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>addAll</span><span style=color:#5bc4bf>(</span>Arrays<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>asList</span><span style=color:#5bc4bf>(</span>urlPatterns<span style=color:#5bc4bf>));</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h2 id=filterchainè¿‡æ»¤å™¨é“¾çš„å®ç°>FilterChainè¿‡æ»¤å™¨é“¾çš„å®ç°</h2><p>å¤§å®¶åº”è¯¥éƒ½çŸ¥é“è¿‡æ»¤å™¨é“¾çš„æ¦‚å¿µï¼Œæ‰€æœ‰è¿‡æ»¤å™¨éƒ½åœ¨è¿‡æ»¤å™¨é“¾ä¸Šï¼Œå½“æœ‰è¯·æ±‚è¿›å…¥ï¼Œå°†ä¾æ¬¡ç»è¿‡æ¯ä¸ªé€‚ç”¨çš„è¿‡æ»¤å™¨ï¼ˆæ ¹æ®è¿‡æ»¤å™¨çš„Url Patternä¸è¯·æ±‚çš„è·¯å¾„è€Œä¸åŒï¼‰ï¼Œè¿‡æ»¤å™¨é‡Œæ‰§è¡Œ<code>doFilter()</code>æ–¹æ³•è®©è¿‡æ»¤å™¨é“¾æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œç›´åˆ°æœ€åä¸€ä¸ªï¼Œåˆ™æ‰§è¡ŒServletçš„<code>service()</code>æ–¹æ³•ã€‚è€Œè¿‡æ»¤å™¨é“¾å¯¹åº”çš„æ¥å£<code>javax.servlet.FilterChain</code>é‡Œé¢å°±ä¸€ä¸ªæ–¹æ³•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>interface</span> <span style=color:#fec418>FilterChain</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>doFilter</span> <span style=color:#5bc4bf>(</span> ServletRequest request<span style=color:#5bc4bf>,</span> ServletResponse response <span style=color:#5bc4bf>)</span> <span style=color:#815ba4>throws</span> IOException<span style=color:#5bc4bf>,</span> ServletException<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><p>æ˜¾ç„¶ï¼Œå®ç°<code>FilterChain</code>æ¥å£ï¼Œåº”è¯¥è¦ç»´æŠ¤ä¸€ä¸ªè¿‡æ»¤å™¨çš„æ•°ç»„æˆ–è€…Listï¼Œè€Œåœ¨<code>doFilter()</code>æ–¹æ³•é‡Œé¢ï¼Œåº”è¯¥åˆ¤æ–­æœ‰æ²¡æœ‰ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œæœ‰åˆ™è°ƒç”¨å…¶<code>doFilter()</code>æ–¹æ³•ï¼Œæ— åˆ™è°ƒç”¨å½“å‰è¯·æ±‚å¯¹åº”Servletå®ä¾‹çš„<code>service()</code>æ–¹æ³•ï¼Œå¯ä»¥ç”¨è¿­ä»£å™¨æˆ–è€…è®°å½•æ¸¸æ ‡ï¼ˆæ•°ç»„æˆ–Listçš„ä¸‹æ ‡ï¼‰æ¥å®ç°ã€‚å…·ä½“ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>NettyFilterChain</span> <span style=color:#815ba4>implements</span> FilterChain <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * è€ƒè™‘åˆ°æ¯ä¸ªè¯·æ±‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œè€Œä¸”ServletContextåœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šnew ä¸€ä¸ªSimpleFilterChainå¯¹è±¡
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * æ‰€ä»¥è¿™é‡ŒæŠŠè¿‡æ»¤å™¨é“¾çš„Iteratorä½œä¸ºFilterChainçš„ç§æœ‰å˜é‡ï¼Œæ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜
</span></span></span><span style=display:flex><span><span style=color:#776e71>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#815ba4>final</span> Iterator<span style=color:#5bc4bf>&lt;</span>Filter<span style=color:#5bc4bf>&gt;</span> filterIterator<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#815ba4>final</span> Servlet servlet<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#06b6ef>NettyFilterChain</span><span style=color:#5bc4bf>(</span>Servlet servlet<span style=color:#5bc4bf>,</span> Iterable<span style=color:#5bc4bf>&lt;</span>Filter<span style=color:#5bc4bf>&gt;</span> filters<span style=color:#5bc4bf>)</span> <span style=color:#815ba4>throws</span> ServletException <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>filterIterator</span> <span style=color:#5bc4bf>=</span> checkNotNull<span style=color:#5bc4bf>(</span>filters<span style=color:#5bc4bf>).</span><span style=color:#06b6ef>iterator</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>servlet</span> <span style=color:#5bc4bf>=</span> checkNotNull<span style=color:#5bc4bf>(</span>servlet<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * æ¯ä¸ªFilteråœ¨å¤„ç†å®Œè¯·æ±‚ä¹‹åè°ƒç”¨FilterChainçš„è¿™ä¸ªæ–¹æ³•ã€‚
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * è¿™æ—¶å€™åº”è¯¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªFilterï¼Œè°ƒç”¨å…¶doFilter()æ–¹æ³•ã€‚
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªäº†ï¼Œåº”è¯¥è°ƒç”¨servletçš„service()æ–¹æ³•äº†
</span></span></span><span style=display:flex><span><span style=color:#776e71>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>doFilter</span><span style=color:#5bc4bf>(</span>ServletRequest request<span style=color:#5bc4bf>,</span> ServletResponse response<span style=color:#5bc4bf>)</span> <span style=color:#815ba4>throws</span> IOException<span style=color:#5bc4bf>,</span> ServletException <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>filterIterator<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>hasNext</span><span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            Filter filter <span style=color:#5bc4bf>=</span> filterIterator<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>next</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>            filter<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>doFilter</span><span style=color:#5bc4bf>(</span>request<span style=color:#5bc4bf>,</span> response<span style=color:#5bc4bf>,</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span> <span style=color:#815ba4>else</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            servlet<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>service</span><span style=color:#5bc4bf>(</span>request<span style=color:#5bc4bf>,</span> response<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h2 id=httpservletrequestçš„å®ç°>HttpServletRequestçš„å®ç°</h2><p>æ¥å£<code>javax.servlet.http.HttpServletRequest</code>çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºCookieç›¸å…³ã€Headerç›¸å…³ã€å„ç§è·¯å¾„ç›¸å…³ã€Sessionç›¸å…³ã€è¯·æ±‚å‚æ•°ç›¸å…³ã€è¯·æ±‚åè®®/åœ°å€/ç«¯å£ç›¸å…³ã€Attributesç›¸å…³ã€å¼‚æ­¥ç›¸å…³ã€multipart/form-dataç›¸å…³ï¼ˆä¸Šä¼ æ–‡ä»¶ï¼‰ç­‰ç­‰æ–¹æ³•ï¼Œä»¥ä¸Šæåˆ°çš„æ–¹æ³•æœ¬æ–‡åŸºæœ¬å®ç°äº†ï¼Œè¿˜æœ‰ä¸€äº›æ²¡å®ç°çš„æ˜¯æš‚æ—¶ç”¨ä¸åˆ°çš„ã€‚</p><h3 id=cookieç›¸å…³æ–¹æ³•>Cookieç›¸å…³æ–¹æ³•</h3><p>Cookieä½¿ç”¨â€œæ‡’è§£æâ€ï¼Œå°±æ˜¯ç”¨æ ‡è¯†<code>isCookieParsed</code>è®°å½•Cookieæ˜¯å¦è¢«è§£æè¿‡ï¼Œåˆå§‹åŒ–Requestå¯¹è±¡çš„æ—¶å€™ä¸è§£æï¼Œåœ¨è·å–Cookieaç›¸å…³æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™å†åˆ¤æ–­æ˜¯å¦æœªè§£æï¼Œè‹¥æœªè§£æåˆ™è§£æå†è¿”å›ï¼Œå¦åˆ™ç›´æ¥è¿”å›ã€‚<code>NettyHttpServletRequest</code>çš„æ„é€ æ–¹æ³•ä¼ å…¥äº†nettyçš„<code>HttpHeaders</code>å®ä¾‹ï¼Œå¯ä»¥ä»ä¸­è·å–Cookieè¯·æ±‚å¤´ï¼Œå†è¿›è¡Œè§£æã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#776e71>/*====== Cookie ç›¸å…³æ–¹æ³• å¼€å§‹ ======*/</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> Cookie<span style=color:#5bc4bf>[]</span> cookies<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> <span style=color:#815ba4>transient</span> <span style=color:#fec418>boolean</span> isCookieParsed <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>false</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> Cookie<span style=color:#5bc4bf>[]</span> <span style=color:#06b6ef>getCookies</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(!</span>isCookieParsed<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        parseCookie<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> cookies<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71> * è§£ærequestä¸­çš„Cookieåˆ°æœ¬ç±»çš„cookiesæ•°ç»„ä¸­
</span></span></span><span style=display:flex><span><span style=color:#776e71> *
</span></span></span><span style=display:flex><span><span style=color:#776e71> * @author Leibniz
</span></span></span><span style=display:flex><span><span style=color:#776e71> */</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>parseCookie</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>isCookieParsed<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String cookieOriginStr <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>get</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;Cookie&#34;</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>cookieOriginStr <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    Set<span style=color:#5bc4bf>&lt;</span>io<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>netty</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>handler</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>codec</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>http</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>cookie</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Cookie</span><span style=color:#5bc4bf>&gt;</span> nettyCookies <span style=color:#5bc4bf>=</span> ServerCookieDecoder<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>LAX</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>decode</span><span style=color:#5bc4bf>(</span>cookieOriginStr<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>nettyCookies<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>size</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>==</span> 0<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>cookies</span> <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> Cookie<span style=color:#5bc4bf>[</span>nettyCookies<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>size</span><span style=color:#5bc4bf>()];</span>
</span></span><span style=display:flex><span>    Iterator<span style=color:#5bc4bf>&lt;</span>io<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>netty</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>handler</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>codec</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>http</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>cookie</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Cookie</span><span style=color:#5bc4bf>&gt;</span> itr <span style=color:#5bc4bf>=</span> nettyCookies<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>iterator</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#fec418>int</span> i <span style=color:#5bc4bf>=</span> 0<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>while</span> <span style=color:#5bc4bf>(</span>itr<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>hasNext</span><span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        io<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>netty</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>handler</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>codec</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>http</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>cookie</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>Cookie</span> nettyCookie <span style=color:#5bc4bf>=</span> itr<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>next</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        Cookie servletCookie <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> Cookie<span style=color:#5bc4bf>(</span>nettyCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>name</span><span style=color:#5bc4bf>(),</span> nettyCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>value</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span><span style=color:#776e71>//            servletCookie.setMaxAge(Ints.checkedCast(nettyCookie.maxAge()));
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>        <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>nettyCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>domain</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> servletCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>setDomain</span><span style=color:#5bc4bf>(</span>nettyCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>domain</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>nettyCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>path</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> servletCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>setPath</span><span style=color:#5bc4bf>(</span>nettyCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>path</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>        servletCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>setHttpOnly</span><span style=color:#5bc4bf>(</span>nettyCookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>isHttpOnly</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>cookies</span><span style=color:#5bc4bf>[</span>i<span style=color:#5bc4bf>++]</span> <span style=color:#5bc4bf>=</span> servletCookie<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>isCookieParsed</span> <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>/*====== Cookie ç›¸å…³æ–¹æ³• ç»“æŸ ======*/</span>
</span></span></code></pre></div><h3 id=headerç›¸å…³æ–¹æ³•>Headerç›¸å…³æ–¹æ³•</h3><p>ä¸Šé¢æåˆ°<code>NettyHttpServletRequest</code>çš„æ„é€ æ–¹æ³•ä¼ å…¥äº†nettyçš„<code>HttpHeaders</code>å®ä¾‹ï¼Œå¯ä»¥ä»ä¸­è·å–æ‰€æœ‰è¯·æ±‚å¤´ï¼Œè€ŒHeaderç›¸å…³æ–¹æ³•çš„å®ç°å°±é ä»–äº†ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#776e71>/*====== Header ç›¸å…³æ–¹æ³• å¼€å§‹ ======*/</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> HttpHeaders headers<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>long</span> <span style=color:#06b6ef>getDateHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getTimeMillis</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> String <span style=color:#06b6ef>getHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>get</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> Enumeration<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>&gt;</span> <span style=color:#06b6ef>getHeaders</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> Collections<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>enumeration</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getAll</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>));</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> Enumeration<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>&gt;</span> <span style=color:#06b6ef>getHeaderNames</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> Collections<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>enumeration</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>names</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>int</span> <span style=color:#06b6ef>getIntHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    String headerStringValue <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>get</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>headerStringValue <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> <span style=color:#5bc4bf>-</span>1<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> Integer<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>parseInt</span><span style=color:#5bc4bf>(</span>headerStringValue<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#776e71>/*====== Header ç›¸å…³æ–¹æ³• ç»“æŸ ======*/</span>
</span></span></code></pre></div><h3 id=sessionç›¸å…³æ–¹æ³•>Sessionç›¸å…³æ–¹æ³•</h3><p>Sessionç›¸å…³æ–¹æ³•ç›¸å¯¹å¤šä¸€äº›ã€‚Sessionçš„è§£æåˆ†ä¸¤ç§ï¼Œé¦–å…ˆå°è¯•ä»Cookieä¸­è·å–Cookieï¼ˆåä¸ºJSESSIONIDï¼‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä»è¯·æ±‚è·¯å¾„ä¸­æ‰¾ç±»ä¼¼";jsessionid=*******&ldquo;çš„å‚æ•°ä½œä¸ºSessionIDã€‚æ‹¿åˆ°SessionIDåï¼Œå†è°ƒç”¨SessionManagerçš„æ–¹æ³•è·å–Sessionå¯¹è±¡ï¼›è€Œæ ¹æ®ä»å“ªé‡Œè§£æåˆ°çš„SessionIDå¯ä»¥è®¾ç½®<code>isCookieSession</code>å’Œ<code>isURLSession</code>ä¸¤ä¸ªå±æ€§ï¼Œç”¨äº<code>isRequestedSessionIdFromCookie()</code>å’Œ<code>isRequestedSessionIdFromURL()</code>æ–¹æ³•ã€‚å¦‚æœæ‹¿ä¸åˆ°SessionIDï¼Œåˆ™è°ƒç”¨SessionManagerçš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°Sessionã€‚<br>è‡³äºSessionå’ŒSessionManagerçš„å®ç°æˆ‘ä»¬åœ¨ä¸‹ä¸€å°èŠ‚å†è®²ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>getSession()</code>æ–¹æ³•è¿”å›çš„å¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„Sessionç±»å®ä¾‹ï¼Œè€Œæ˜¯å…¶é—¨é¢ç±»ï¼Œæ˜¯å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼›è¿™ä¸€ç‚¹å‚è€ƒäº†Tomcatçš„åšæ³•ï¼ˆTomcatçš„Requestã€Responseã€Sessionç­‰å¯¹è±¡éƒ½æ˜¯ç”¨é—¨é¢æ¨¡å¼ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>private</span> NettyHttpSession session<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> <span style=color:#fec418>boolean</span> isCookieSession<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> <span style=color:#fec418>boolean</span> isURLSession<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71> * å…ˆåçœ‹è¯·æ±‚è·¯å¾„å’ŒCookieä¸­æ˜¯å¦æœ‰sessionid
</span></span></span><span style=display:flex><span><span style=color:#776e71> * æœ‰ï¼Œåˆ™ä»SessionManagerè·å–sessionå¯¹è±¡æ”¾å…¥sessionå±æ€§
</span></span></span><span style=display:flex><span><span style=color:#776e71> * å¦‚æœsessionå¯¹è±¡è¿‡æœŸï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å¹¶æ”¾å…¥
</span></span></span><span style=display:flex><span><span style=color:#776e71> * æ— ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°Sessionå¹¶æ”¾å…¥
</span></span></span><span style=display:flex><span><span style=color:#776e71> */</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>parseSession</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    String sessionId<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    NettyHttpSession curSession<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>//ä»Cookieè§£æSessionID
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    sessionId <span style=color:#5bc4bf>=</span> getSessionIdFromCookie<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>sessionId <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>        curSession <span style=color:#5bc4bf>=</span> servletContext<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSessionManager</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>(</span>sessionId<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span><span style=color:#815ba4>null</span> <span style=color:#5bc4bf>!=</span> curSession<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>isCookieSession</span> <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>            recoverySession<span style=color:#5bc4bf>(</span>curSession<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(!</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>isCookieSession</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#776e71>// ä»è¯·æ±‚è·¯å¾„è§£æSessionID
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>        sessionId <span style=color:#5bc4bf>=</span> getSessionIdFromUrl<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        curSession <span style=color:#5bc4bf>=</span> servletContext<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSessionManager</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>(</span>sessionId<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>null</span> <span style=color:#5bc4bf>!=</span> curSession<span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>isURLSession</span> <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>            recoverySession<span style=color:#5bc4bf>(</span>curSession<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>//Cookieå’Œè¯·æ±‚å‚æ•°ä¸­éƒ½æ²¡æ‹¿åˆ°Sessionï¼Œåˆ™åˆ›å»ºä¸€ä¸ª
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span> <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span> <span style=color:#5bc4bf>=</span> createtSession<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71> * @return ä»URLè§£æåˆ°çš„SessionID
</span></span></span><span style=display:flex><span><span style=color:#776e71> */</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> String <span style=color:#06b6ef>getSessionIdFromUrl</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    StringBuilder u <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> StringBuilder<span style=color:#5bc4bf>(</span>request<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>uri</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>    <span style=color:#fec418>int</span> sessionStart <span style=color:#5bc4bf>=</span> u<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>toString</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>indexOf</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;;&#34;</span> <span style=color:#5bc4bf>+</span> NettyHttpSession<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SESSION_REQUEST_PARAMETER_NAME</span> <span style=color:#5bc4bf>+</span> <span style=color:#48b685>&#34;=&#34;</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>sessionStart <span style=color:#5bc4bf>==</span> <span style=color:#5bc4bf>-</span>1<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#fec418>int</span> sessionEnd <span style=color:#5bc4bf>=</span> u<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>toString</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>indexOf</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#39;;&#39;</span><span style=color:#5bc4bf>,</span> sessionStart <span style=color:#5bc4bf>+</span> 1<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>sessionEnd <span style=color:#5bc4bf>==</span> <span style=color:#5bc4bf>-</span>1<span style=color:#5bc4bf>)</span>
</span></span><span style=display:flex><span>        sessionEnd <span style=color:#5bc4bf>=</span> u<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>toString</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>indexOf</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#39;?&#39;</span><span style=color:#5bc4bf>,</span> sessionStart <span style=color:#5bc4bf>+</span> 1<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>sessionEnd <span style=color:#5bc4bf>==</span> <span style=color:#5bc4bf>-</span>1<span style=color:#5bc4bf>)</span> <span style=color:#776e71>// still
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>        sessionEnd <span style=color:#5bc4bf>=</span> u<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>length</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> u<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>substring</span><span style=color:#5bc4bf>(</span>sessionStart <span style=color:#5bc4bf>+</span> NettyHttpSession<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SESSION_REQUEST_PARAMETER_NAME</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>length</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>+</span> 2<span style=color:#5bc4bf>,</span> sessionEnd<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71> * @return ä»Cookieè§£æåˆ°çš„SessionID
</span></span></span><span style=display:flex><span><span style=color:#776e71> */</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> String <span style=color:#06b6ef>getSessionIdFromCookie</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    Cookie<span style=color:#5bc4bf>[]</span> cookies <span style=color:#5bc4bf>=</span> getCookies<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>cookies <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>for</span> <span style=color:#5bc4bf>(</span>Cookie cookie <span style=color:#5bc4bf>:</span> cookies<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getName</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>equals</span><span style=color:#5bc4bf>(</span>NettyHttpSession<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SESSION_COOKIE_NAME</span><span style=color:#5bc4bf>))</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>return</span> cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getValue</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71> * æ¢å¤æ—§Session
</span></span></span><span style=display:flex><span><span style=color:#776e71> * @param curSession è¦æ¢å¤çš„Sessionå¯¹è±¡
</span></span></span><span style=display:flex><span><span style=color:#776e71> */</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>recoverySession</span><span style=color:#5bc4bf>(</span>NettyHttpSession curSession<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span> <span style=color:#5bc4bf>=</span> curSession<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>setNew</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>false</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>servletContext</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSessionManager</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>updateAccessTime</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> HttpSession <span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>(</span><span style=color:#fec418>boolean</span> create<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#fec418>boolean</span> valid <span style=color:#5bc4bf>=</span> isRequestedSessionIdValid<span style=color:#5bc4bf>();</span> <span style=color:#776e71>//åœ¨ç®¡ç†å™¨å­˜åœ¨ï¼Œä¸”æ²¡åˆ°æœŸ
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#776e71>//å¯ç”¨åˆ™ç›´æ¥è¿”å›
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>valid<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>//ä¸å¯ç”¨åˆ™åˆ¤æ–­æ˜¯å¦æ–°å»º
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(!</span>create<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        session <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>;</span> <span style=color:#776e71>//å¦‚æœè¿‡æœŸäº†è®¾ä¸ºnull
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>        <span style=color:#815ba4>return</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>//ä¸å¯ç”¨ä¸”å…è®¸æ–°å»ºåˆ™æ–°å»ºä¹‹
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span> <span style=color:#5bc4bf>=</span> createtSession<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> HttpSession <span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> getSession<span style=color:#5bc4bf>(</span><span style=color:#815ba4>true</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> String <span style=color:#06b6ef>changeSessionId</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span> <span style=color:#5bc4bf>=</span> createtSession<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>session</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getId</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> NettyHttpSession <span style=color:#06b6ef>createtSession</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> servletContext<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSessionManager</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>createSession</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>isRequestedSessionIdValid</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> servletContext<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSessionManager</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>checkValid</span><span style=color:#5bc4bf>(</span>session<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>isRequestedSessionIdFromCookie</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> isCookieSession<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>isRequestedSessionIdFromURL</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> isURLSession<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Deprecated</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>isRequestedSessionIdFromUrl</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> isRequestedSessionIdFromURL<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> String <span style=color:#06b6ef>getRequestedSessionId</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getId</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#776e71>/*====== Session ç›¸å…³æ–¹æ³• ç»“æŸ ======*/</span>
</span></span></code></pre></div><h2 id=httpservletresponseå®ç°>HttpServletResponseå®ç°</h2><p>HttpServletResponseæ¥å£ç›¸å¯¹ç®€å•ä¸€ç‚¹ï¼Œæ–¹æ³•å°‘ä¸€ç‚¹ï¼Œä¸‹é¢åˆ—ä¸¾å‡ºéƒ¨åˆ†æ–¹æ³•çš„å®ç°ã€‚</p><h3 id=headerç›¸å…³æ–¹æ³•-1>Headerç›¸å…³æ–¹æ³•</h3><p>è¿™é‡Œçš„HeaderæŒ‡å“åº”å¤´ã€‚<code>NettyHttpServletResponse</code>çš„æ„é€ æ–¹æ³•é‡Œä¼ å…¥äº†nettyçš„<code>HttpResponse</code>å¯¹è±¡ï¼Œé»˜è®¤çš„è°ƒç”¨æ˜¯ä¼ å…¥ä¸€ä¸ª200çš„æ­£å¸¸HTTPå“åº”ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ª<code>HttpResponse</code>å¯¹è±¡çš„<code>headers()</code>æ–¹æ³•å¯¹å“åº”å¤´è¿›è¡Œæ“ä½œã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>setDateHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> <span style=color:#fec418>long</span> date<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    response<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>set</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> date<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>addDateHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> <span style=color:#fec418>long</span> date<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    response<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>add</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> date<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>setHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> String value<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>name <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>||</span> name<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>length</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>==</span> 0 <span style=color:#5bc4bf>||</span> value <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>isCommitted<span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>setHeaderField<span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>))</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    response<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>set</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#815ba4>private</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>setHeaderField</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> String value<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#fec418>char</span> c <span style=color:#5bc4bf>=</span> name<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>charAt</span><span style=color:#5bc4bf>(</span>0<span style=color:#5bc4bf>);</span><span style=color:#776e71>//å‡å°‘åˆ¤æ–­çš„æ—¶é—´ï¼Œæé«˜æ•ˆç‡
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span><span style=color:#48b685>&#39;C&#39;</span> <span style=color:#5bc4bf>==</span> c <span style=color:#5bc4bf>||</span> <span style=color:#48b685>&#39;c&#39;</span> <span style=color:#5bc4bf>==</span> c<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>HttpHeaderNames<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>CONTENT_TYPE</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>contentEqualsIgnoreCase</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>))</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            setContentType<span style=color:#5bc4bf>(</span>value<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>return</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> <span style=color:#815ba4>false</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>addHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> String value<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>name <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>||</span> name<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>length</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>==</span> 0 <span style=color:#5bc4bf>||</span> value <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>isCommitted<span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>setHeaderField<span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>))</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    response<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>add</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>setIntHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> <span style=color:#fec418>int</span> value<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>name <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>||</span> name<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>length</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>==</span> 0<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>isCommitted<span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    response<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>set</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>addIntHeader</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> <span style=color:#fec418>int</span> value<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>name <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>||</span> name<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>length</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>==</span> 0<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>isCommitted<span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    response<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>add</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h3 id=getnettyresponseæ–¹æ³•>getNettyResponse()æ–¹æ³•</h3><p>æ–¹æ³•<code>public HttpResponse getNettyResponse()</code>æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ï¼Œç”¨äºå“åº”è¾“å‡ºæµåœ¨å†™å…¥æ—¶åšçš„ä¸€äº›åŸºæœ¬å¤„ç†ï¼Œä¸»è¦æ˜¯è¯·æ±‚å¤´çš„å¤„ç†ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71> * è®¾ç½®åŸºæœ¬çš„è¯·æ±‚å¤´
</span></span></span><span style=display:flex><span><span style=color:#776e71> */</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>public</span> HttpResponse <span style=color:#06b6ef>getNettyResponse</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>committed<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> response<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    committed <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    HttpHeaders headers <span style=color:#5bc4bf>=</span> response<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>headers</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span><span style=color:#815ba4>null</span> <span style=color:#5bc4bf>!=</span> contentType<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        String value <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>==</span> characterEncoding <span style=color:#5bc4bf>?</span> contentType <span style=color:#5bc4bf>:</span> contentType <span style=color:#5bc4bf>+</span> <span style=color:#48b685>&#34;; charset=&#34;</span> <span style=color:#5bc4bf>+</span> characterEncoding<span style=color:#5bc4bf>;</span> <span style=color:#776e71>//Content Type å“åº”å¤´çš„å†…å®¹
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>        headers<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>set</span><span style=color:#5bc4bf>(</span>HttpHeaderNames<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>CONTENT_TYPE</span><span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    CharSequence date <span style=color:#5bc4bf>=</span> getFormattedDate<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    headers<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>set</span><span style=color:#5bc4bf>(</span>HttpHeaderNames<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>DATE</span><span style=color:#5bc4bf>,</span> date<span style=color:#5bc4bf>);</span> <span style=color:#776e71>// æ—¶é—´æ—¥æœŸå“åº”å¤´
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    headers<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>set</span><span style=color:#5bc4bf>(</span>HttpHeaderNames<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SERVER</span><span style=color:#5bc4bf>,</span> servletContext<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getServerInfo</span><span style=color:#5bc4bf>());</span> <span style=color:#776e71>//æœåŠ¡å™¨ä¿¡æ¯å“åº”å¤´
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>// cookieså¤„ç†
</span></span></span><span style=display:flex><span><span style=color:#776e71>//        long curTime = System.currentTimeMillis(); //ç”¨äºæ ¹æ®maxAgeè®¡ç®—Cookieçš„Expires
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#776e71>//å…ˆå¤„ç†Session ï¼Œå¦‚æœæ˜¯æ–°Sessionéœ€è¦é€šè¿‡Cookieå†™å…¥
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>request<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>isNew</span><span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        String sessionCookieStr <span style=color:#5bc4bf>=</span> NettyHttpSession<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SESSION_COOKIE_NAME</span> <span style=color:#5bc4bf>+</span> <span style=color:#48b685>&#34;=&#34;</span> <span style=color:#5bc4bf>+</span> request<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getRequestedSessionId</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>+</span> <span style=color:#48b685>&#34;; path=/; domain=&#34;</span> <span style=color:#5bc4bf>+</span> request<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getServerName</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        headers<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>add</span><span style=color:#5bc4bf>(</span>HttpHeaderNames<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SET_COOKIE</span><span style=color:#5bc4bf>,</span> sessionCookieStr<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>//å…¶ä»–ä¸šåŠ¡æˆ–æ¡†æ¶è®¾ç½®çš„cookieï¼Œé€æ¡å†™å…¥åˆ°å“åº”å¤´å»
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>    <span style=color:#815ba4>for</span> <span style=color:#5bc4bf>(</span>Cookie cookie <span style=color:#5bc4bf>:</span> cookies<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        StringBuilder sb <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> StringBuilder<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        sb<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getName</span><span style=color:#5bc4bf>()).</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;=&#34;</span><span style=color:#5bc4bf>).</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getValue</span><span style=color:#5bc4bf>())</span>
</span></span><span style=display:flex><span>                <span style=color:#5bc4bf>.</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;; max-Age=&#34;</span><span style=color:#5bc4bf>).</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getMaxAge</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getPath</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> sb<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;; path=&#34;</span><span style=color:#5bc4bf>).</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getPath</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span> <span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getDomain</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>)</span> sb<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;; domain=&#34;</span><span style=color:#5bc4bf>).</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span>cookie<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getDomain</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>        headers<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>add</span><span style=color:#5bc4bf>(</span>HttpHeaderNames<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SET_COOKIE</span><span style=color:#5bc4bf>,</span> sb<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>toString</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> response<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h2 id=sessionå®ç°>Sessionå®ç°</h2><p>Sessionç›¸å…³çš„åŒ…æ‹¬Sessionå®ç°ç±»<code>NettyHttpSession</code>ï¼ŒSessionné—¨é¢åŒ…è£…ç±»<code>NettyHttpSessionFacade</code>ï¼Œä»¥åŠSessionç®¡ç†å™¨<code>NettySessionManager</code>ã€‚<br>é—¨é¢ç±»å‰é¢æåŠåˆ°äº†ï¼Œæ„é€ çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ª<code>NettyHttpSession</code>å®ä¾‹å¹¶æŒæœ‰ï¼Œæ‰€æœ‰<code>HttpSession</code>æ¥å£çš„æ–¹æ³•éƒ½è°ƒç”¨<code>NettyHttpSession</code>å®ä¾‹çš„å¯¹åº”æ–¹æ³•å»å¤„ç†ã€‚<br>Sessionç®¡ç†å™¨<code>NettySessionManager</code>æ˜¯å•ä¾‹ï¼Œç”±<code>NettyContext</code>å®ä¾‹æŒæœ‰ï¼Œè´Ÿè´£å­˜å‚¨æ‰€æœ‰Sessionçš„æ˜ å°„ï¼Œæ–¹ä¾¿å…¶ä»–ç±»æ ¹æ®SessionIDå»è·å–Sessionå¯¹è±¡ï¼Œæä¾›åˆ›å»ºæ–°Sessionçš„æ–¹æ³•ï¼Œå…è®¸æ›´æ–°Sessionè®¿é—®æ—¶é—´ï¼ŒåŒæ—¶å®šæ—¶æ¸…ç†è¿‡æœŸçš„Sessionã€‚<br>æ¯ä¸ª<code>NettyHttpSession</code>å®ä¾‹éƒ½æŒæœ‰<code>NettySessionManager</code>çš„å¼•ç”¨ï¼Œå®ç°äº†<code>HttpSession</code>æ¥å£ã€‚</p><h3 id=nettyhttpsession>NettyHttpSession</h3><p>å®ç°æ¯”è¾ƒç®€å•ï¼ŒAttributeç”±å¯¹è±¡æŒæœ‰çš„HashMapè¿›è¡Œå­˜å‚¨ï¼Œè‡ªèº«ä¿å­˜IDã€åˆ›å»ºæ—¶é—´ã€è®¿é—®æ—¶é—´ã€ç”Ÿå‘½å‘¨æœŸç­‰ä¿¡æ¯ã€‚
å…·ä½“ä»£ç å¦‚ä¸‹ï¼ˆéƒ¨åˆ†è¿‡æ—¶çš„æ–¹æ³•ã€ç®€å•çš„getterä¸åˆ—å‡ºï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>NettyHttpSession</span> <span style=color:#815ba4>implements</span> HttpSession<span style=color:#5bc4bf>,</span> Serializable <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#815ba4>static</span> <span style=color:#815ba4>final</span> String SESSION_COOKIE_NAME <span style=color:#5bc4bf>=</span> <span style=color:#48b685>&#34;JSESSIONID&#34;</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#815ba4>static</span> <span style=color:#815ba4>final</span> String SESSION_REQUEST_PARAMETER_NAME <span style=color:#5bc4bf>=</span> <span style=color:#48b685>&#34;jsessionid&#34;</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> NettySessionManager manager<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#fec418>long</span> creationTime<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#fec418>long</span> lastAccessedTime<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#fec418>int</span> interval <span style=color:#5bc4bf>=</span> NettySessionManager<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>SESSION_LIFE_SECONDS</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> String id<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    NettyHttpSession<span style=color:#5bc4bf>(</span>String id<span style=color:#5bc4bf>,</span> NettySessionManager manager<span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>        <span style=color:#fec418>long</span> curTime <span style=color:#5bc4bf>=</span> System<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>currentTimeMillis</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>creationTime</span> <span style=color:#5bc4bf>=</span> curTime<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>lastAccessedTime</span> <span style=color:#5bc4bf>=</span> curTime<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>id</span> <span style=color:#5bc4bf>=</span> id<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>manager</span> <span style=color:#5bc4bf>=</span> manager<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>sessionFacade</span> <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> NettyHttpSessionFacade<span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> HttpSession sessionFacade<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> HttpSession <span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>(){</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> sessionFacade<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fec418>void</span> <span style=color:#06b6ef>updateAccessTime</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        lastAccessedTime <span style=color:#5bc4bf>=</span> System<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>currentTimeMillis</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>setMaxInactiveInterval</span><span style=color:#5bc4bf>(</span><span style=color:#fec418>int</span> interval<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>interval</span> <span style=color:#5bc4bf>=</span> interval<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> Map<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>,</span> Object<span style=color:#5bc4bf>&gt;</span> attributes <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> ConcurrentHashMap<span style=color:#5bc4bf>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> Object <span style=color:#06b6ef>getAttribute</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> attributes<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>get</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>setAttribute</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>,</span> Object value<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        attributes<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>put</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>,</span> value<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>removeAttribute</span><span style=color:#5bc4bf>(</span>String name<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        attributes<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>remove</span><span style=color:#5bc4bf>(</span>name<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>invalidate</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        attributes<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>clear</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        attributes <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        manager<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>invalidate</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>this</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        manager <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#fec418>boolean</span> isNew <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>true</span><span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>isNew</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> isNew<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>setNew</span><span style=color:#5bc4bf>(</span><span style=color:#fec418>boolean</span> isNew<span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>isNew</span> <span style=color:#5bc4bf>=</span> isNew<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * æ˜¯å¦è¿‡æœŸ
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * @return
</span></span></span><span style=display:flex><span><span style=color:#776e71>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>expire</span><span style=color:#5bc4bf>(){</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> System<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>currentTimeMillis</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>-</span> creationTime <span style=color:#5bc4bf>&gt;=</span> interval <span style=color:#5bc4bf>*</span> 1000<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h3 id=nettysessionmanager>NettySessionManager</h3><p>Sessionç®¡ç†å™¨æ²¡æœ‰ç°æˆçš„æ¥å£ï¼Œå› ä¸ºæ¯”è¾ƒç®€å•æ‰€ä»¥ä¹Ÿæ²¡æŠ½å‡ºæ¥å£ï¼Œè‡ªå·±åœ¨å®ç°çš„è¿‡ç¨‹ä¸­æ ¹æ®éœ€æ±‚å†™äº†ä¸€äº›publicæ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨ConcurrentHashMapå­˜å‚¨æ‰€æœ‰Sessionã€‚</li><li>åœ¨æ„é€ çš„åŒæ—¶å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯éš”<code>SESSION_LIFE_CHECK_INTER</code>æ¯«ç§’æ‰«ææ‰€æœ‰Sessionåˆ¤æ–­æ˜¯å¦è¿‡æœŸéœ€è¦æ¸…é™¤ï¼ˆæœ‰å¾…ä¼˜åŒ–ï¼Œæ¯”å¦‚ç­‰å¾…æ—¶é—´æŒ‰æœ€å¿«è¿‡æœŸçš„sessionçš„è¿‡æœŸæ—¶é—´ï¼Œæˆ–è€…è®°å½•é¢„è®¡ä¸‹æ¬¡éœ€è¦å¤„ç†çš„ä¸ªæ•°ï¼Œå‡å°‘éå†çš„æ•°é‡ï¼‰ã€‚</li><li>SessionIDæ˜¯6ä½éšæœºæ•°å­—+æ—¶é—´æˆ³ç¿»è½¬ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>NettySessionManager</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> Logger log <span style=color:#5bc4bf>=</span> LoggerFactory<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getLogger</span><span style=color:#5bc4bf>(</span>getClass<span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> NettyContext servletContext<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> Map<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>,</span> NettyHttpSession<span style=color:#5bc4bf>&gt;</span> sessions <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> ConcurrentHashMap<span style=color:#5bc4bf>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>static</span> <span style=color:#815ba4>final</span> <span style=color:#fec418>int</span> SESSION_LIFE_SECONDS <span style=color:#5bc4bf>=</span> 60 <span style=color:#5bc4bf>*</span> 30<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>static</span> <span style=color:#815ba4>final</span> <span style=color:#fec418>int</span> SESSION_LIFE_MILLISECONDS <span style=color:#5bc4bf>=</span> SESSION_LIFE_SECONDS <span style=color:#5bc4bf>*</span> 1000<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#815ba4>static</span> <span style=color:#815ba4>final</span> <span style=color:#fec418>int</span> SESSION_LIFE_CHECK_INTER <span style=color:#5bc4bf>=</span> 1000 <span style=color:#5bc4bf>*</span> 60<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#06b6ef>NettySessionManager</span><span style=color:#5bc4bf>(</span>NettyContext servletContext<span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>this</span><span style=color:#5bc4bf>.</span><span style=color:#06b6ef>servletContext</span> <span style=color:#5bc4bf>=</span> servletContext<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>new</span> Thread<span style=color:#5bc4bf>(</span><span style=color:#815ba4>new</span> checkInvalidSessions<span style=color:#5bc4bf>(),</span> <span style=color:#48b685>&#34;Session-Check&#34;</span><span style=color:#5bc4bf>).</span><span style=color:#06b6ef>start</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fec418>void</span> <span style=color:#06b6ef>invalidate</span><span style=color:#5bc4bf>(</span>HttpSession session<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        sessions<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>remove</span><span style=color:#5bc4bf>(</span>session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getId</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>updateAccessTime</span><span style=color:#5bc4bf>(</span>NettyHttpSession session<span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>session <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>            session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>updateAccessTime</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>boolean</span> <span style=color:#06b6ef>checkValid</span><span style=color:#5bc4bf>(</span>NettyHttpSession session<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> session <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>&amp;&amp;</span> sessions<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>get</span><span style=color:#5bc4bf>(</span>session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getId</span><span style=color:#5bc4bf>())</span> <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>&amp;&amp;</span> <span style=color:#5bc4bf>!</span>session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>expire</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> NettyHttpSession <span style=color:#06b6ef>getSession</span><span style=color:#5bc4bf>(</span>String id<span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> id <span style=color:#5bc4bf>==</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>?</span> <span style=color:#815ba4>null</span> <span style=color:#5bc4bf>:</span> sessions<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>get</span><span style=color:#5bc4bf>(</span>id<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> NettyHttpSession <span style=color:#06b6ef>createSession</span><span style=color:#5bc4bf>(){</span>
</span></span><span style=display:flex><span>        String id <span style=color:#5bc4bf>=</span> createUniqueSessionId<span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>        NettyHttpSession newSession <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> NettyHttpSession<span style=color:#5bc4bf>(</span>id<span style=color:#5bc4bf>,</span> <span style=color:#815ba4>this</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        sessions<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>put</span><span style=color:#5bc4bf>(</span>id <span style=color:#5bc4bf>,</span>newSession<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> newSession<span style=color:#5bc4bf>;</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> String <span style=color:#06b6ef>createUniqueSessionId</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        String prefix <span style=color:#5bc4bf>=</span> String<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>valueOf</span><span style=color:#5bc4bf>(</span>100000 <span style=color:#5bc4bf>+</span> <span style=color:#815ba4>new</span> Random<span style=color:#5bc4bf>().</span><span style=color:#06b6ef>nextInt</span><span style=color:#5bc4bf>(</span>899999<span style=color:#5bc4bf>));</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>return</span> <span style=color:#815ba4>new</span> StringBuilder<span style=color:#5bc4bf>().</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span>System<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>currentTimeMillis</span><span style=color:#5bc4bf>()).</span><span style=color:#06b6ef>reverse</span><span style=color:#5bc4bf>().</span><span style=color:#06b6ef>append</span><span style=color:#5bc4bf>(</span>prefix<span style=color:#5bc4bf>).</span><span style=color:#06b6ef>toString</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>setOldSession</span><span style=color:#5bc4bf>(</span>NettyHttpSession session<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>session <span style=color:#5bc4bf>!=</span> <span style=color:#815ba4>null</span><span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>            session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>setNew</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>false</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#776e71>/**
</span></span></span><span style=display:flex><span><span style=color:#776e71>     * è¶…æ—¶çš„Sessionæ— æ•ˆåŒ–ï¼Œå®šæœŸæ‰§è¡Œ
</span></span></span><span style=display:flex><span><span style=color:#776e71>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#815ba4>private</span> <span style=color:#815ba4>class</span> <span style=color:#fec418>checkInvalidSessions</span> <span style=color:#815ba4>implements</span> Runnable <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>run</span><span style=color:#5bc4bf>()</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>            log<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>info</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;Session Manager expire-checking thread has been started...&#34;</span><span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>            <span style=color:#815ba4>while</span><span style=color:#5bc4bf>(</span><span style=color:#815ba4>true</span><span style=color:#5bc4bf>){</span>
</span></span><span style=display:flex><span>                <span style=color:#815ba4>try</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                    Thread<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>sleep</span><span style=color:#5bc4bf>(</span>SESSION_LIFE_CHECK_INTER<span style=color:#5bc4bf>);</span>
</span></span><span style=display:flex><span>                <span style=color:#5bc4bf>}</span> <span style=color:#815ba4>catch</span> <span style=color:#5bc4bf>(</span>InterruptedException e<span style=color:#5bc4bf>)</span> <span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>                    e<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>printStackTrace</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>                <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>                <span style=color:#fec418>long</span> curTime <span style=color:#5bc4bf>=</span> System<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>currentTimeMillis</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>                <span style=color:#815ba4>for</span><span style=color:#5bc4bf>(</span>NettyHttpSession session <span style=color:#5bc4bf>:</span> sessions<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>values</span><span style=color:#5bc4bf>()){</span>
</span></span><span style=display:flex><span>                    <span style=color:#815ba4>if</span><span style=color:#5bc4bf>(</span>session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>expire</span><span style=color:#5bc4bf>()){</span>
</span></span><span style=display:flex><span>                        log<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>info</span><span style=color:#5bc4bf>(</span><span style=color:#48b685>&#34;Session(ID={}) is invalidated by Session Manager&#34;</span><span style=color:#5bc4bf>,</span> session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>getId</span><span style=color:#5bc4bf>());</span>
</span></span><span style=display:flex><span>                        session<span style=color:#5bc4bf>.</span><span style=color:#06b6ef>invalidate</span><span style=color:#5bc4bf>();</span>
</span></span><span style=display:flex><span>                    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>                <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>            <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h3 id=å¯ä»¥æ”¹è¿›çš„åœ°æ–¹>å¯ä»¥æ”¹è¿›çš„åœ°æ–¹</h3><ul><li>SessionæŒä¹…åŒ–ï¼ŒåŒ…æ‹¬å¯é€‰çš„æŒä¹…åŒ–æ—¶é—´é—´éš”ã€shutdownè‡ªåŠ¨æŒä¹…åŒ–ã€startupè‡ªåŠ¨è¯»å…¥ã€‚</li><li>Redisé›†ä¸­å­˜å‚¨Sessionï¼Œä¾¿äºæœåŠ¡é›†ç¾¤ä½¿ç”¨</li><li>ä¼˜åŒ–è§£æé€Ÿåº¦</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/Netty/>Netty</a>
<a href=/tags/Spring-Boot/>Spring Boot</a>
<a href=/tags/Servlet/>Servlet</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under Apache License 2.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%BA%94/><div class=article-image><img src=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%BA%94/lzwx.e90c62716067760f53ef8748025a1653_hu1afe6b3663fa6cb2c80c0a666eabfb57_157940_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆäº”ï¼‰" data-hash="md5-6QxicWBndg9T74dIAloWUw=="></div><div class=article-details><h2 class=article-title>åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆäº”ï¼‰</h2></div></a></article><article class=has-image><a href=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%89/><div class=article-image><img src=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%89/yuyuko2.1c117d4033c6a3d65832bc8cb5537310_hueaf00a8425bfe94574c5d8750a924d5c_123372_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆä¸‰ï¼‰" data-hash="md5-HBF9QDPGo9ZYMryMtVNzEA=="></div><div class=article-details><h2 class=article-title>åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆä¸‰ï¼‰</h2></div></a></article><article class=has-image><a href=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%BA%8C/><div class=article-image><img src=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%BA%8C/sanae.ad1a3b3f97a8ef8c39506c03f84ad1f7_hu112f514aec6702f2f444da4fa7f9ccac_72624_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆäºŒï¼‰" data-hash="md5-rRo7P5eo74w5UGwD+ErR9w=="></div><div class=article-details><h2 class=article-title>åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆäºŒï¼‰</h2></div></a></article><article class=has-image><a href=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%80/><div class=article-image><img src=/p/%E5%9F%BA%E4%BA%8ENetty%E7%9A%84Spring-Boot%E5%86%85%E7%BD%AEServlet%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%80/yuyuko.fce0b1976f277f565fe6da2813834311_hua56c2355a3520ae6430109398d99a70a_98080_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆä¸€ï¼‰" data-hash="md5-/OCxl28nf1Zf5tooE4NDEQ=="></div><div class=article-details><h2 class=article-title>åŸºäºNettyçš„Spring Bootå†…ç½®Servletå®¹å™¨çš„å®ç°ï¼ˆä¸€ï¼‰</h2></div></a></article><article class=has-image><a href=/p/%E6%9C%80%E8%BF%91%E5%AF%B9Java%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E6%80%9D%E8%80%83/><div class=article-image><img src=/p/%E6%9C%80%E8%BF%91%E5%AF%B9Java%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E6%80%9D%E8%80%83/mokou_kaguya.f8956c7d4c79ae0c70980bce3b639df0_hu1b6d38c05bcdc128b7d4abee3ea0602c_80982_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post æœ€è¿‘å¯¹JavaæœåŠ¡æ¡†æ¶çš„æ€è€ƒ" data-hash="md5-+JVsfUx5rgxwmAvOO2Od8A=="></div><div class=article-details><h2 class=article-title>æœ€è¿‘å¯¹JavaæœåŠ¡æ¡†æ¶çš„æ€è€ƒ</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//leibnizhu.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2016 -
2022 Heaven's Door</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#registrationæ³¨å†Œå™¨çš„å®ç°>Registrationæ³¨å†Œå™¨çš„å®ç°</a><ol><li><a href=#è®¾è®¡ä¸ç»§æ‰¿ç»“æ„>è®¾è®¡ä¸ç»§æ‰¿ç»“æ„</a></li><li><a href=#ä»£ç å®ç°>ä»£ç å®ç°</a></li></ol></li><li><a href=#filterchainè¿‡æ»¤å™¨é“¾çš„å®ç°>FilterChainè¿‡æ»¤å™¨é“¾çš„å®ç°</a></li><li><a href=#httpservletrequestçš„å®ç°>HttpServletRequestçš„å®ç°</a><ol><li><a href=#cookieç›¸å…³æ–¹æ³•>Cookieç›¸å…³æ–¹æ³•</a></li><li><a href=#headerç›¸å…³æ–¹æ³•>Headerç›¸å…³æ–¹æ³•</a></li><li><a href=#sessionç›¸å…³æ–¹æ³•>Sessionç›¸å…³æ–¹æ³•</a></li></ol></li><li><a href=#httpservletresponseå®ç°>HttpServletResponseå®ç°</a><ol><li><a href=#headerç›¸å…³æ–¹æ³•-1>Headerç›¸å…³æ–¹æ³•</a></li><li><a href=#getnettyresponseæ–¹æ³•>getNettyResponse()æ–¹æ³•</a></li></ol></li><li><a href=#sessionå®ç°>Sessionå®ç°</a><ol><li><a href=#nettyhttpsession>NettyHttpSession</a></li><li><a href=#nettysessionmanager>NettySessionManager</a></li><li><a href=#å¯ä»¥æ”¹è¿›çš„åœ°æ–¹>å¯ä»¥æ”¹è¿›çš„åœ°æ–¹</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>